var P,_this,__extends,Genesis;(function(n){function ei(n){for(var i=n.length,r=new Array(i),t=0;i>t;t++)r[t]=n[t];return r}function to(n,t){var r,i,u;if(oi&&t.stack&&"object"==typeof n&&null!==n&&n.stack&&-1===n.stack.indexOf(of)){for(r=[],i=t;i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(n.stack);u=r.join("\n"+of+"\n");n.stack=io(u)}}function io(n){for(var t,r=n.split("\n"),u=[],i=0,f=r.length;f>i;i++)t=r[i],ro(t)||uo(t)||!t||u.push(t);return u.join("\n")}function ro(n){var t=cu(n),r,i;return t?(r=t[0],i=t[1],r===ef&&i>=ts&&no>=i):!1}function uo(n){return-1!==n.indexOf("(module.js:")||-1!==n.indexOf("(node.js:")}function hu(){if(oi)try{throw new Error;}catch(i){var n=i.stack.split("\n"),r=n[0].indexOf("@")>0?n[1]:n[2],t=cu(r);return t?(ef=t[0],t[1]):void 0}}function cu(n){var r=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n),t,i;return r?[r[1],Number(r[2])]:(t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n),t)?[t[1],Number(t[2])]:(i=/.*@(.+):(\d+)$/.exec(n),i?[i[1],Number(i[2])]:void 0)}function fo(n){var i=[],u,f,t,s,r;if(!wf(n))return i;d.nonEnumArgs&&n.length&&ci(n)&&(n=fr.call(n));u=d.enumPrototypes&&"function"==typeof n;f=d.enumErrorProps&&(n===ur||n instanceof Error);for(t in n)u&&"prototype"==t||f&&("message"==t||"name"==t)||i.push(t);if(d.nonEnumShadows&&n!==pf){var e=n.constructor,o=-1,h=hf;for(n===(e&&e.prototype)&&(s=n===us?hi:n===ur?af:yt.call(n),r=ft[s]);++o<h;)t=ir[o],r&&r[t]||!bt.call(n,t)||i.push(t)}return i}function eo(n,t,i){for(var r,u=-1,f=i(n),e=f.length;++u<e;)if(r=f[u],t(n[r],r,n)===!1)break;return n}function lu(n,t){return eo(n,t,fo)}function au(n){return"function"!=typeof n.toString&&"string"==typeof(n+"")}function hr(n,t,i,r){var l,a,f,c,y,s,h,o,u,e,p;if(n===t)return 0!==n||1/n==1/t;if((l=typeof n,a=typeof t,n===n&&(null==n||null==t||"function"!=l&&"object"!=l&&"function"!=a&&"object"!=a))||(f=yt.call(n),c=yt.call(t),f==rr&&(f=si),c==rr&&(c=si),f!=c))return!1;switch(f){case cf:case lf:return+n==+t;case vf:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case yf:case hi:return n==String(t)}if(y=f==yr,!y&&(f!=si||!d.nodeClass&&(au(n)||au(t))||(s=!d.argsObject&&ci(n)?Object:n.constructor,h=!d.argsObject&&ci(t)?Object:t.constructor,!(s==h||bt.call(n,"constructor")&&bt.call(t,"constructor")||v(s)&&s instanceof s&&v(h)&&h instanceof h||!("constructor"in n&&"constructor"in t)))))return!1;for(i||(i=[]),r||(r=[]),o=i.length;o--;)if(i[o]==n)return r[o]==t;if(u=0,e=!0,i.push(n),r.push(t),y){if(o=n.length,u=t.length,e=u==o)for(;u--;)if(p=t[u],!(e=hr(n[u],p,i,r)))break}else lu(t,function(t,f,o){if(bt.call(o,f))return(u++,e=bt.call(n,f)&&hr(n[f],t,i,r))}),e&&lu(n,function(n,t,i){if(bt.call(i,t))return e=--u>-1});return i.pop(),r.pop(),e}function pt(n,t){for(var r=new Array(n),i=0;n>i;i++)r[i]=t();return r}function oo(){try{return bf.apply(this,arguments)}catch(n){return a.e=n,a}}function b(n){if(!v(n))throw new TypeError("fn must be a function");return bf=n,oo}function ot(n){throw n;}function vu(n,t){this.id=n;this.value=t}function yu(n,t){this.scheduler=n;this.disposable=t;this.isDisposed=!1}function so(n,t){t.isDisposed||(t.isDisposed=!0,t.disposable.dispose())}function dt(n){this.observer=n;this.a=[];this.isStopped=!1}function pu(){this._s=s}function cr(){this._s=s;this._l=s.length;this._i=0}function wu(n){this._a=n}function lr(n){this._a=n;this._l=ao(n);this._i=0}function ho(n){return"number"==typeof n&&f.isFinite(n)}function co(t){var i,r=t[y];if(!r&&"string"==typeof t)return i=new pu(t),i[y]();if(!r&&t.length!==n)return i=new wu(t),i[y]();if(!r)throw new TypeError("Object is not iterable");return t[y]()}function lo(n){var t=+n;return 0===t?t:isNaN(t)?t:0>t?-1:1}function ao(n){var t=+n.length;return isNaN(t)?0:0!==t&&ho(t)?(t=lo(t)*Math.floor(Math.abs(t)),0>=t?0:t>ue?ue:t):t}function bu(n,t){this.observer=n;this.parent=t}function ku(n,t){return tt(n)||(n=it),new vi(t,n)}function du(n,t){this.observer=n;this.parent=t}function gu(n,t){this.observer=n;this.parent=t}function vo(n,t){return new r(function(i){var u=new e,r=new nt;return r.setDisposable(u),u.setDisposable(n.subscribe(function(n){i.onNext(n)},function(n){var u,f;try{u=t(n)}catch(s){return i.onError(s)}h(u)&&(u=o(u));f=new e;r.setDisposable(f);f.setDisposable(u.subscribe(i))},function(n){i.onCompleted(n)})),r},n)}function yo(n,t){var i=this;return new r(function(r){var u=0,f=n.length;return i.subscribe(function(i){if(f>u){var e,o=n[u++];try{e=t(i,o)}catch(s){return r.onError(s)}r.onNext(e)}else r.onCompleted()},function(n){r.onError(n)},function(){r.onCompleted()})},i)}function po(){return!1}function wo(){return[]}function nf(n,t,i){var r=ut(t,i,3);return n.map(function(t,i){var u=r(t,i,n);return h(u)&&(u=o(u)),(tr(u)||nr(u))&&(u=ai(u)),u}).concatAll()}function bo(n,t,i){for(var r=0,u=n.length;u>r;r++)if(i(n[r],t))return r;return-1}function tf(n){this.comparer=n;this.set=[]}function gt(n,t,i){this.observer=n;this.selector=t;this.source=i;this.i=0;this.isStopped=!1}function rf(n,t,i){var r=ut(t,i,3);return n.map(function(t,i){var u=r(t,i,n);return h(u)&&(u=o(u)),(tr(u)||nr(u))&&(u=ai(u)),u}).mergeAll()}function ni(n,t,i){this.observer=n;this.predicate=t;this.source=i;this.i=0;this.isStopped=!1}var yi={boolean:!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},f=yi[typeof window]&&window||this,pi=yi[typeof exports]&&exports&&!exports.nodeType&&exports,wi=yi[typeof module]&&module&&!module.nodeType&&module,uf=wi&&wi.exports===pi&&pi,at=yi[typeof global]&&global,oi,ar,vt,ti,vr,ft,d,wf,ci,kr,dr,li,st,l,er,kt,nt,kf,ii,lt,fi,o,re,ai,vi,fe,ee,oe,se,he,ce,le,ve,ye,pe,we,be,fu,ke,eu,ou,sr,ge,no;at&&(at.global===at||at.window===at)&&(f=at);var i={internals:{},config:{Promise:f.Promise},helpers:{}},k=i.helpers.noop=function(){},wt=(i.helpers.notDefined=function(n){return"undefined"==typeof n},i.helpers.identity=function(n){return n}),bi=(i.helpers.pluck=function(n){return function(t){return t[n]}},i.helpers.just=function(n){return function(){return n}},i.helpers.defaultNow=function(){return Date.now?Date.now:function(){return+new Date}}()),ff=i.helpers.defaultComparer=function(n,t){return fs(n,t)},ko=i.helpers.defaultSubComparer=function(n,t){return n>t?1:t>n?-1:0},go=(i.helpers.defaultKeySerializer=function(n){return n.toString()},i.helpers.defaultError=function(n){throw n;}),h=i.helpers.isPromise=function(n){return!!n&&"function"==typeof n.then},v=(i.helpers.asArray=function(){return Array.prototype.slice.call(arguments)},i.helpers.not=function(n){return!n},i.helpers.isFunction=function(){var n=function(n){return"function"==typeof n||!1};return n(/x/)&&(n=function(n){return"function"==typeof n&&"[object Function]"==yt.call(n)}),n}());i.config.longStackSupport=!1;oi=!1;try{throw new Error;}catch(ns){oi=!!ns.stack}var ef,ts=hu(),of="From previous event:",is=i.EmptyError=function(){this.message="Sequence contains no elements.";Error.call(this)};is.prototype=Error.prototype;ar=i.ObjectDisposedError=function(){this.message="Object has been disposed";Error.call(this)};ar.prototype=Error.prototype;vt=i.ArgumentOutOfRangeError=function(){this.message="Argument out of range";Error.call(this)};vt.prototype=Error.prototype;ti=i.NotSupportedError=function(n){this.message=n||"This operation is not supported";Error.call(this)};ti.prototype=Error.prototype;vr=i.NotImplementedError=function(n){this.message=n||"This operation is not implemented";Error.call(this)};vr.prototype=Error.prototype;var ki=i.helpers.notImplemented=function(){throw new vr;},di=i.helpers.notSupported=function(){throw new ti;},y="function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";f.Set&&"function"==typeof(new f.Set)["@@iterator"]&&(y="@@iterator");var gi=i.doneEnumerator={done:!0,value:n},nr=i.helpers.isIterable=function(t){return t[y]!==n},tr=i.helpers.isArrayLike=function(t){return t&&t.length!==n};i.helpers.iterator=y;var sf,ut=i.internals.bindCallback=function(n,t,i){if("undefined"==typeof t)return n;switch(i){case 0:return function(){return n.call(t)};case 1:return function(i){return n.call(t,i)};case 2:return function(i,r){return n.call(t,i,r)};case 3:return function(i,r,u){return n.call(t,i,r,u)}}return function(){return n.apply(t,arguments)}},ir=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],hf=ir.length,rr="[object Arguments]",yr="[object Array]",cf="[object Boolean]",lf="[object Date]",af="[object Error]",pr="[object Function]",vf="[object Number]",si="[object Object]",yf="[object RegExp]",hi="[object String]",yt=Object.prototype.toString,bt=Object.prototype.hasOwnProperty,rs=yt.call(arguments)==rr,ur=Error.prototype,pf=Object.prototype,us=String.prototype,wr=pf.propertyIsEnumerable;try{sf=!(yt.call(document)==si&&!({toString:0}+""))}catch(ns){sf=!0}ft={};ft[yr]=ft[lf]=ft[vf]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0};ft[cf]=ft[hi]={constructor:!0,toString:!0,valueOf:!0};ft[af]=ft[pr]=ft[yf]={constructor:!0,toString:!0};ft[si]={constructor:!0};d={};!function(){var t=function(){this.x=1},i=[],n;t.prototype={valueOf:1,y:1};for(n in new t)i.push(n);for(n in arguments);d.enumErrorProps=wr.call(ur,"message")||wr.call(ur,"name");d.enumPrototypes=wr.call(t,"prototype");d.nonEnumArgs=0!=n;d.nonEnumShadows=!/valueOf/.test(i)}(1);wf=i.internals.isObject=function(n){var t=typeof n;return n&&("function"==t||"object"==t)||!1};ci=function(n){return n&&"object"==typeof n?yt.call(n)==rr:!1};rs||(ci=function(n){return n&&"object"==typeof n?bt.call(n,"callee"):!1});var bf,fs=i.internals.isEqual=function(n,t){return hr(n,t,[],[])},fr=({}.hasOwnProperty,Array.prototype.slice),c=this.inherits=i.internals.inherits=function(n,t){function i(){this.constructor=n}i.prototype=t.prototype;n.prototype=new i},br=i.internals.addProperties=function(n){for(var t,e,u,f,i=[],r=1,o=arguments.length;o>r;r++)i.push(arguments[r]);for(t=0,e=i.length;e>t;t++){u=i[t];for(f in u)n[f]=u[f]}},es=i.internals.addRef=function(n,t){return new r(function(i){return new l(t.getDisposable(),n.subscribe(i))})},a={e:{}};Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,i=fr.call(arguments,1),r=function(){function f(){}if(this instanceof r){f.prototype=t.prototype;var e=new f,u=t.apply(e,i.concat(fr.call(arguments)));return Object(u)===u?u:e}return t.apply(n,i.concat(fr.call(arguments)))};return r});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){var u,i,r,f,e;if(null==this)throw new TypeError(" this is null or not defined");if(r=Object(this),f=r.length>>>0,"function"!=typeof n)throw new TypeError(n+" is not a function");for(arguments.length>1&&(u=t),i=0;f>i;)i in r&&(e=r[i],n.call(u,e,i,r)),i++});kr=Object("a");dr="a"!=kr[0]||!(0 in kr);Array.prototype.every||(Array.prototype.every=function(n){var r=Object(this),i=dr&&{}.toString.call(this)==hi?this.split(""):r,u=i.length>>>0,f=arguments[1],t;if({}.toString.call(n)!=pr)throw new TypeError(n+" is not a function");for(t=0;u>t;t++)if(t in i&&!n.call(f,i[t],t,r))return!1;return!0});Array.prototype.map||(Array.prototype.map=function(n){var r=Object(this),i=dr&&{}.toString.call(this)==hi?this.split(""):r,u=i.length>>>0,f=Array(u),e=arguments[1],t;if({}.toString.call(n)!=pr)throw new TypeError(n+" is not a function");for(t=0;u>t;t++)t in i&&(f[t]=n.call(e,i[t],t,r));return f});Array.prototype.filter||(Array.prototype.filter=function(n){for(var r,u=[],i=new Object(this),t=0,f=i.length>>>0;f>t;t++)r=i[t],t in i&&n.call(arguments[1],r,t,i)&&u.push(r);return u});Array.isArray||(Array.isArray=function(n){return{}.toString.call(n)==yr});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u=Object(this),r=u.length>>>0,t,i;if(0===r||(t=0,arguments.length>1&&(t=Number(arguments[1]),t!==t?t=0:0!==t&&t!=1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);r>i;i++)if(i in u&&u[i]===n)return i;return-1});Object.prototype.propertyIsEnumerable||(Object.prototype.propertyIsEnumerable=function(n){for(var t in this)if(t===n)return!0;return!1});Object.keys||(Object.keys=function(){"use strict";var n=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString");return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var u,r,f=[];for(u in i)n.call(i,u)&&f.push(u);if(t)for(r=0;hf>r;r++)n.call(i,ir[r])&&f.push(ir[r]);return f}}());vu.prototype.compareTo=function(n){var t=this.value.compareTo(n.value);return 0===t&&(t=this.id-n.id),t};li=i.internals.PriorityQueue=function(n){this.items=new Array(n);this.length=0};st=li.prototype;st.isHigherPriority=function(n,t){return this.items[n].compareTo(this.items[t])<0};st.percolate=function(n){var t,i;n>=this.length||0>n||(t=n-1>>1,0>t||t===n||!this.isHigherPriority(n,t)||(i=this.items[n],this.items[n]=this.items[t],this.items[t]=i,this.percolate(t)))};st.heapify=function(n){var u;if(+n||(n=0),!(n>=this.length||0>n)){var i=2*n+1,r=2*n+2,t=n;(i<this.length&&this.isHigherPriority(i,t)&&(t=i),r<this.length&&this.isHigherPriority(r,t)&&(t=r),t!==n)&&(u=this.items[n],this.items[n]=this.items[t],this.items[t]=u,this.heapify(t))}};st.peek=function(){return this.items[0].value};st.removeAt=function(t){this.items[t]=this.items[--this.length];this.items[this.length]=n;this.heapify()};st.dequeue=function(){var n=this.peek();return this.removeAt(0),n};st.enqueue=function(n){var t=this.length++;this.items[t]=new vu(li.count++,n);this.percolate(t)};st.remove=function(n){for(var t=0;t<this.length;t++)if(this.items[t].value===n)return this.removeAt(t),!0;return!1};li.count=0;l=i.CompositeDisposable=function(){var n,i,t=[];if(Array.isArray(arguments[0]))t=arguments[0],i=t.length;else for(i=arguments.length,t=new Array(i),n=0;i>n;n++)t[n]=arguments[n];for(n=0;i>n;n++)if(!os(t[n]))throw new TypeError("Not a disposable");this.disposables=t;this.isDisposed=!1;this.length=t.length};er=l.prototype;er.add=function(n){this.isDisposed?n.dispose():(this.disposables.push(n),this.length++)};er.remove=function(n){var i=!1,t;return this.isDisposed||(t=this.disposables.indexOf(n),-1!==t&&(i=!0,this.disposables.splice(t,1),this.length--,n.dispose())),i};er.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;for(var t=this.disposables.length,i=new Array(t),n=0;t>n;n++)i[n]=this.disposables[n];for(this.disposables=[],this.length=0,n=0;t>n;n++)i[n].dispose()}};kt=i.Disposable=function(n){this.isDisposed=!1;this.action=n||k};kt.prototype.dispose=function(){this.isDisposed||(this.action(),this.isDisposed=!0)};var ht=kt.create=function(n){return new kt(n)},g=kt.empty={dispose:k},os=kt.isDisposable=function(n){return n&&v(n.dispose)},ct=kt.checkDisposed=function(n){if(n.isDisposed)throw new ar;},e=i.SingleAssignmentDisposable=function(){this.isDisposed=!1;this.current=null};e.prototype.getDisposable=function(){return this.current};e.prototype.setDisposable=function(n){if(this.current)throw new Error("Disposable has already been assigned");var t=this.isDisposed;t||(this.current=n);t&&n&&n.dispose()};e.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var n=this.current;this.current=null}n&&n.dispose()};nt=i.SerialDisposable=function(){this.isDisposed=!1;this.current=null};nt.prototype.getDisposable=function(){return this.current};nt.prototype.setDisposable=function(n){var i=this.isDisposed,t;i||(t=this.current,this.current=n);t&&t.dispose();i&&n&&n.dispose()};nt.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;var n=this.current;this.current=null}n&&n.dispose()};kf=i.RefCountDisposable=function(){function t(n){this.disposable=n;this.disposable.count++;this.isInnerDisposed=!1}function n(n){this.underlyingDisposable=n;this.isDisposed=!1;this.isPrimaryDisposed=!1;this.count=0}return t.prototype.dispose=function(){this.disposable.isDisposed||this.isInnerDisposed||(this.isInnerDisposed=!0,this.disposable.count--,0===this.disposable.count&&this.disposable.isPrimaryDisposed&&(this.disposable.isDisposed=!0,this.disposable.underlyingDisposable.dispose()))},n.prototype.dispose=function(){this.isDisposed||this.isPrimaryDisposed||(this.isPrimaryDisposed=!0,0===this.count&&(this.isDisposed=!0,this.underlyingDisposable.dispose()))},n.prototype.getDisposable=function(){return this.isDisposed?g:new t(this)},n}();yu.prototype.dispose=function(){this.scheduler.scheduleWithState(this,so)};ii=i.internals.ScheduledItem=function(n,t,i,r,u){this.scheduler=n;this.state=t;this.action=i;this.dueTime=r;this.comparer=u||ko;this.disposable=new e};ii.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())};ii.prototype.compareTo=function(n){return this.comparer(this.dueTime,n.dueTime)};ii.prototype.isCancelled=function(){return this.disposable.isDisposed};ii.prototype.invokeCore=function(){return this.action(this.scheduler,this.state)};var p=i.Scheduler=function(){function n(n,t,i,r){this.now=n;this._schedule=t;this._scheduleRelative=i;this._scheduleAbsolute=r}function i(n,t){return t(),g}n.isScheduler=function(t){return t instanceof n};var t=n.prototype;return t.schedule=function(n){return this._schedule(n,i)},t.scheduleWithState=function(n,t){return this._schedule(n,t)},t.scheduleWithRelative=function(n,t){return this._scheduleRelative(t,n,i)},t.scheduleWithRelativeAndState=function(n,t,i){return this._scheduleRelative(n,t,i)},t.scheduleWithAbsolute=function(n,t){return this._scheduleAbsolute(t,n,i)},t.scheduleWithAbsoluteAndState=function(n,t,i){return this._scheduleAbsolute(n,t,i)},n.now=bi,n.normalize=function(n){return 0>n&&(n=0),n},n}(),ss=p.normalize,tt=p.isScheduler;!function(n){function r(n,t){function r(t){f(t,function(t){var u=!1,f=!1,e=n.scheduleWithState(t,function(n,t){return u?i.remove(e):f=!0,r(t),g});f||(i.add(e),u=!0)})}var u=t[0],f=t[1],i=new l;return r(u),i}function t(n,t,i){function u(t){e(t,function(t,f){var e=!1,o=!1,s=n[i](t,f,function(n,t){return e?r.remove(s):o=!0,u(t),g});o||(r.add(s),e=!0)})}var f=t[0],e=t[1],r=new l;return u(f),r}function i(n,t){n(function(i){t(n,i)})}n.scheduleRecursive=function(n){return this.scheduleRecursiveWithState(n,function(n,t){n(function(){t(n)})})};n.scheduleRecursiveWithState=function(n,t){return this.scheduleWithState([n,t],r)};n.scheduleRecursiveWithRelative=function(n,t){return this.scheduleRecursiveWithRelativeAndState(t,n,i)};n.scheduleRecursiveWithRelativeAndState=function(n,i,r){return this._scheduleRelative([n,r],i,function(n,i){return t(n,i,"scheduleWithRelativeAndState")})};n.scheduleRecursiveWithAbsolute=function(n,t){return this.scheduleRecursiveWithAbsoluteAndState(t,n,i)};n.scheduleRecursiveWithAbsoluteAndState=function(n,i,r){return this._scheduleAbsolute([n,r],i,function(n,i){return t(n,i,"scheduleWithAbsoluteAndState")})}}(p.prototype),function(){p.prototype.schedulePeriodic=function(n,t){return this.schedulePeriodicWithState(null,n,t)};p.prototype.schedulePeriodicWithState=function(n,t,i){if("undefined"==typeof f.setInterval)throw new ti;t=ss(t);var r=n,u=f.setInterval(function(){r=i(r)},t);return ht(function(){f.clearInterval(u)})}}(p.prototype),function(n){n.catchError=n["catch"]=function(n){return new cs(this,n)}}(p.prototype);var ri,gr,et=(i.internals.SchedulePeriodicRecursive=function(){function t(n,t){t(0,this._period);try{this._state=this._action(this._state)}catch(i){throw this._cancel.dispose(),i;}}function n(n,t,i,r){this._scheduler=n;this._state=t;this._period=i;this._action=r}return n.prototype.start=function(){var n=new e;return this._cancel=n,n.setDisposable(this._scheduler.scheduleRecursiveWithRelativeAndState(0,this._period,t.bind(this))),n},n}(),p.immediate=function(){function n(n,t){return t(this,n)}return new p(bi,n,di,di)}()),it=p.currentThread=function(){function i(){for(;n.length>0;){var t=n.dequeue();t.isCancelled()||t.invoke()}}function r(t,r){var u=new ii(this,t,r,this.now()),f;if(n)n.enqueue(u);else if(n=new li(4),n.enqueue(u),f=b(i)(),n=null,f===a)return ot(f.e);return u.disposable}var n,t=new p(bi,r,di,di);return t.scheduleRequired=function(){return!n},t}(),df=function(){var n,t=k;if(f.setTimeout)n=f.setTimeout,t=f.clearTimeout;else{if(!f.WScript)throw new ti;n=function(n,t){f.WScript.Sleep(t);n()}}return{setTimeout:n,clearTimeout:t}}(),nu=df.setTimeout,hs=df.clearTimeout;!function(){function t(i){var r,u;if(o)nu(function(){t(i)},0);else if(r=n[i],r&&(o=!0,u=b(r)(),gr(i),o=!1,u===a))return ot(u.e)}function c(){if(!f.postMessage||f.importScripts)return!1;var n=!1,t=f.onmessage;return f.onmessage=function(){n=!0},f.postMessage("","*"),f.onmessage=t,n}function e(n){"string"==typeof n.data&&n.data.substring(0,u.length)===u&&t(n.data.substring(u.length))}var i=1,n={},o=!1,h,r,u,s;gr=function(t){delete n[t]};h=RegExp("^"+String(yt).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");r="function"==typeof(r=at&&uf&&at.setImmediate)&&!h.test(r)&&r;v(r)?ri=function(u){var f=i++;return n[f]=u,r(function(){t(f)}),f}:"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?ri=function(r){var u=i++;return n[u]=r,process.nextTick(function(){t(u)}),u}:c()?(u="ms.rx.schedule"+Math.random(),f.addEventListener?f.addEventListener("message",e,!1):f.attachEvent?f.attachEvent("onmessage",e):f.onmessage=e,ri=function(t){var r=i++;return n[r]=t,f.postMessage(u+currentId,"*"),r}):f.MessageChannel?(s=new f.MessageChannel,s.port1.onmessage=function(n){t(n.data)},ri=function(t){var r=i++;return n[r]=t,s.port2.postMessage(r),r}):ri="document"in f&&"onreadystatechange"in f.document.createElement("script")?function(r){var u=f.document.createElement("script"),e=i++;return n[e]=r,u.onreadystatechange=function(){t(e);u.onreadystatechange=null;u.parentNode.removeChild(u);u=null},f.document.documentElement.appendChild(u),e}:function(r){var u=i++;return n[u]=r,nu(function(){t(u)},0),u}}();var cs=(p.timeout=p["default"]=function(){function n(n,t){var r=this,i=new e,u=ri(function(){i.isDisposed||i.setDisposable(t(r,n))});return new l(i,ht(function(){gr(u)}))}function t(n,t,i){var u=this,f=p.normalize(t),r=new e,o;return 0===f?u.scheduleWithState(n,i):(o=nu(function(){r.isDisposed||r.setDisposable(i(u,n))},f),new l(r,ht(function(){hs(o)})))}function i(n,t,i){return this.scheduleWithRelativeAndState(n,t-this.now(),i)}return new p(bi,n,t,i)}(),function(n){function i(n,t){return this._scheduler.scheduleWithState(n,this._wrap(t))}function r(n,t,i){return this._scheduler.scheduleWithRelativeAndState(n,t,this._wrap(i))}function u(n,t,i){return this._scheduler.scheduleWithAbsoluteAndState(n,t,this._wrap(i))}function t(t,f){this._scheduler=t;this._handler=f;this._recursiveOriginal=null;this._recursiveWrapper=null;n.call(this,this._scheduler.now.bind(this._scheduler),i,r,u)}return c(t,n),t.prototype._clone=function(n){return new t(n,this._handler)},t.prototype._wrap=function(n){var t=this;return function(i,r){try{return n(t._getRecursiveWrapper(i),r)}catch(u){if(!t._handler(u))throw u;return g}}},t.prototype._getRecursiveWrapper=function(n){if(this._recursiveOriginal!==n){this._recursiveOriginal=n;var t=this._clone(n);t._recursiveOriginal=n;t._recursiveWrapper=t;this._recursiveWrapper=t}return this._recursiveWrapper},t.prototype.schedulePeriodicWithState=function(n,t,i){var f=this,u=!1,r=new e;return r.setDisposable(this._scheduler.schedulePeriodicWithState(n,t,function(n){if(u)return null;try{return i(n)}catch(t){if(u=!0,!f._handler(t))throw t;return r.dispose(),null}})),r},t}(p)),ui=i.Notification=function(){function n(n,t,i,r,u,f){this.kind=n;this.value=t;this.exception=i;this._accept=r;this._acceptObservable=u;this.toString=f}return n.prototype.accept=function(n,t,i){return n&&"object"==typeof n?this._acceptObservable(n):this._accept(n,t,i)},n.prototype.toObservable=function(n){var t=this;return tt(n)||(n=et),new r(function(i){return n.scheduleWithState(t,function(n,t){t._acceptObservable(i);"N"===t.kind&&i.onCompleted()})})},n}(),gf=ui.createOnNext=function(){function n(n){return n(this.value)}function t(n){return n.onNext(this.value)}function i(){return"OnNext("+this.value+")"}return function(r){return new ui("N",r,null,n,t,i)}}(),ne=ui.createOnError=function(){function n(n,t){return t(this.exception)}function t(n){return n.onError(this.exception)}function i(){return"OnError("+this.exception+")"}return function(r){return new ui("E",null,r,n,t,i)}}(),te=ui.createOnCompleted=function(){function n(n,t,i){return i()}function t(n){return n.onCompleted()}function i(){return"OnCompleted()"}return function(){return new ui("C",null,null,n,t,i)}}(),or=i.internals.Enumerator=function(n){this._next=n};or.prototype.next=function(){return this._next()};or.prototype[y]=function(){return this};lt=i.internals.Enumerable=function(n){this._iterator=n};lt.prototype[y]=function(){return this._iterator()};lt.prototype.concat=function(){var n=this;return new r(function(t){var i,u=n[y](),r=new nt,f=et.scheduleRecursive(function(n){var s,f,c;if(!i){try{s=u.next()}catch(l){return t.onError(l)}if(s.done)return t.onCompleted();f=s.value;h(f)&&(f=o(f));c=new e;r.setDisposable(c);c.setDisposable(f.subscribe(function(n){t.onNext(n)},function(n){t.onError(n)},n))}});return new l(r,f,ht(function(){i=!0}))})};lt.prototype.catchError=function(){var n=this;return new r(function(t){var i,u=n[y](),r=new nt,f=et.scheduleRecursiveWithState(null,function(n,f){var c,s,l;if(!i){try{c=u.next()}catch(a){return observer.onError(a)}if(c.done)return void(null!==n?t.onError(n):t.onCompleted());s=c.value;h(s)&&(s=o(s));l=new e;r.setDisposable(l);l.setDisposable(s.subscribe(function(n){t.onNext(n)},f,function(){t.onCompleted()}))}});return new l(r,f,ht(function(){i=!0}))})};lt.prototype.catchErrorWhen=function(n){var t=this;return new r(function(i){var r,u,f=new sr,s=new sr,a=n(f),v=a.subscribe(s),p=t[y](),c=new nt,w=et.scheduleRecursive(function(n){var a,t,v,y;if(!r){try{a=p.next()}catch(w){return i.onError(w)}if(a.done)return void(u?i.onError(u):i.onCompleted());t=a.value;h(t)&&(t=o(t));v=new e;y=new e;c.setDisposable(new l(y,v));v.setDisposable(t.subscribe(function(n){i.onNext(n)},function(t){y.setDisposable(s.subscribe(n,function(n){i.onError(n)},function(){i.onCompleted()}));f.onNext(t)},function(){i.onCompleted()}))}});return new l(v,c,w,ht(function(){r=!0}))})};var tu=lt.repeat=function(n,t){return null==t&&(t=-1),new lt(function(){var i=t;return new or(function(){return 0===i?gi:(i>0&&i--,{done:!1,value:n})})})},iu=lt.of=function(n,t,i){if(t)var r=ut(t,i,3);return new lt(function(){var i=-1;return new or(function(){return++i<n.length?{done:!1,value:t?r(n[i],i,n):n[i]}:gi})})},rt=i.Observer=function(){};rt.prototype.toNotifier=function(){var n=this;return function(t){return t.accept(n)}};rt.prototype.asObserver=function(){return new uu(this.onNext.bind(this),this.onError.bind(this),this.onCompleted.bind(this))};rt.prototype.checked=function(){return new ls(this)};fi=rt.create=function(n,t,i){return n||(n=k),t||(t=go),i||(i=k),new uu(n,t,i)};rt.fromNotifier=function(n,t){return new uu(function(i){return n.call(t,gf(i))},function(i){return n.call(t,ne(i))},function(){return n.call(t,te())})};rt.prototype.notifyOn=function(n){return new ie(n,this)};rt.prototype.makeSafe=function(n){return new AnonymousSafeObserver(this._onNext,this._onError,this._onCompleted,n)};var t,ru=i.internals.AbstractObserver=function(n){function t(){this.isStopped=!1;n.call(this)}return c(t,n),t.prototype.next=ki,t.prototype.error=ki,t.prototype.completed=ki,t.prototype.onNext=function(n){this.isStopped||this.next(n)},t.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.error(n))},t.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.completed())},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.error(n),!0)},t}(rt),uu=i.AnonymousObserver=function(n){function t(t,i,r){n.call(this);this._onNext=t;this._onError=i;this._onCompleted=r}return c(t,n),t.prototype.next=function(n){this._onNext(n)},t.prototype.error=function(n){this._onError(n)},t.prototype.completed=function(){this._onCompleted()},t}(ru),ls=function(n){function i(t){n.call(this);this._observer=t;this._state=0}c(i,n);var t=i.prototype;return t.onNext=function(n){this.checkAccess();var t=b(this._observer.onNext).call(this._observer,n);this._state=0;t===a&&ot(t.e)},t.onError=function(n){this.checkAccess();var t=b(this._observer.onError).call(this._observer,n);this._state=2;t===a&&ot(t.e)},t.onCompleted=function(){this.checkAccess();var n=b(this._observer.onCompleted).call(this._observer);this._state=2;n===a&&ot(n.e)},t.checkAccess=function(){if(1===this._state)throw new Error("Re-entrancy detected");if(2===this._state)throw new Error("Observer completed");0===this._state&&(this._state=1)},i}(rt),as=i.internals.ScheduledObserver=function(n){function t(t,i){n.call(this);this.scheduler=t;this.observer=i;this.isAcquired=!1;this.hasFaulted=!1;this.queue=[];this.disposable=new nt}return c(t,n),t.prototype.next=function(n){var t=this;this.queue.push(function(){t.observer.onNext(n)})},t.prototype.error=function(n){var t=this;this.queue.push(function(){t.observer.onError(n)})},t.prototype.completed=function(){var n=this;this.queue.push(function(){n.observer.onCompleted()})},t.prototype.ensureActive=function(){var t=!1,n=this;!this.hasFaulted&&this.queue.length>0&&(t=!this.isAcquired,this.isAcquired=!0);t&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(function(t){var i;if(!(n.queue.length>0))return void(n.isAcquired=!1);i=n.queue.shift();try{i()}catch(r){throw n.queue=[],n.hasFaulted=!0,r;}t()}))},t.prototype.dispose=function(){n.prototype.dispose.call(this);this.disposable.dispose()},t}(ru),ie=function(n){function t(t,i,r){n.call(this,t,i);this._cancel=r}return c(t,n),t.prototype.next=function(t){n.prototype.next.call(this,t);this.ensureActive()},t.prototype.error=function(t){n.prototype.error.call(this,t);this.ensureActive()},t.prototype.completed=function(){n.prototype.completed.call(this);this.ensureActive()},t.prototype.dispose=function(){n.prototype.dispose.call(this);this._cancel&&this._cancel.dispose();this._cancel=null},t}(as),u=i.Observable=function(){function n(n){if(i.config.longStackSupport&&oi){try{throw new Error;}catch(t){this.stack=t.stack.substring(t.stack.indexOf("\n")+1)}var r=this;this._subscribe=function(t){var i=t.onError.bind(t);return t.onError=function(n){to(n,r);i(n)},n.call(r,t)}}else this._subscribe=n}return t=n.prototype,t.subscribe=t.forEach=function(n,t,i){return this._subscribe("object"==typeof n?n:fi(n,t,i))},t.subscribeOnNext=function(n,t){return this._subscribe(fi("undefined"!=typeof t?function(i){n.call(t,i)}:n))},t.subscribeOnError=function(n,t){return this._subscribe(fi(null,"undefined"!=typeof t?function(i){n.call(t,i)}:n))},t.subscribeOnCompleted=function(n,t){return this._subscribe(fi(null,null,"undefined"!=typeof t?function(){n.call(t)}:n))},n}(),w=i.ObservableBase=function(n){function r(n){return n&&v(n.dispose)?n:v(n)?ht(n):g}function i(n,t){var i=t[0],u=t[1],f=b(u.subscribeCore).call(u,i);return f!==a||i.fail(a.e)?void i.setDisposable(r(f)):ot(a.e)}function u(n){var t=new de(n),r=[t,this];return it.scheduleRequired()?it.scheduleWithState(r,i):i(null,r),t}function t(){n.call(this,u)}return c(t,n),t.prototype.subscribeCore=ki,t}(u);t.observeOn=function(n){var t=this;return new r(function(i){return t.subscribe(new ie(n,i))},t)};t.subscribeOn=function(n){var t=this;return new r(function(i){var u=new e,r=new nt;return r.setDisposable(u),u.setDisposable(n.schedule(function(){r.setDisposable(new yu(n,t.subscribe(i)))})),r},t)};o=u.fromPromise=function(n){return vs(function(){var t=new i.AsyncSubject;return n.then(function(n){t.onNext(n);t.onCompleted()},t.onError.bind(t)),t})};t.toPromise=function(n){if(n||(n=i.config.Promise),!n)throw new ti("Promise type not provided nor in Rx.config.Promise");var t=this;return new n(function(n,i){var r,u=!1;t.subscribe(function(n){r=n;u=!0},i,function(){u&&n(r)})})};re=function(n){function t(t){this.source=t;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){return this.source.subscribe(new dt(n))},t}(w);dt.prototype.onNext=function(n){this.isStopped||this.a.push(n)};dt.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.observer.onError(n))};dt.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.observer.onNext(this.a),this.observer.onCompleted())};dt.prototype.dispose=function(){this.isStopped=!0};dt.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(n),!0)};t.toArray=function(){return new re(this)};u.create=u.createWithDisposable=function(n,t){return new r(n,t)};var vs=u.defer=function(n){return new r(function(t){var i;try{i=n()}catch(r){return ae(r).subscribe(t)}return h(i)&&(i=o(i)),i.subscribe(t)})},ys=function(n){function t(t){this.scheduler=t;n.call(this)}function i(n,t){this.observer=n;this.parent=t}function r(n,t){t.onCompleted()}return c(t,n),t.prototype.subscribeCore=function(n){var t=new i(n,this);return t.run()},i.prototype.run=function(){return this.parent.scheduler.scheduleWithState(this.observer,r)},t}(w),ps=u.empty=function(n){return tt(n)||(n=et),new ys(n)},ws=function(n){function t(t,i,r){this.iterable=t;this.mapper=i;this.scheduler=r;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new bs(n,this);return t.run()},t}(w),bs=function(){function n(n,t){this.observer=n;this.parent=t}return n.prototype.run=function(){function i(i,r){var e,f;try{e=u.next()}catch(o){return n.onError(o)}if(e.done)return n.onCompleted();if(f=e.value,t)try{f=t(f,i)}catch(o){return n.onError(o)}n.onNext(f);r(i+1)}var r=Object(this.parent.iterable),u=co(r),n=this.observer,t=this.parent.mapper;return this.parent.scheduler.scheduleRecursiveWithState(0,i)},n}(),ue=Math.pow(2,53)-1;pu.prototype[y]=function(){return new cr(this._s)};cr.prototype[y]=function(){return this};cr.prototype.next=function(){return this._i<this._l?{done:!1,value:this._s.charAt(this._i++)}:gi};wu.prototype[y]=function(){return new lr(this._a)};lr.prototype[y]=function(){return this};lr.prototype.next=function(){return this._i<this._l?{done:!1,value:this._a[this._i++]}:gi};ai=u.from=function(n,t,i,r){if(null==n)throw new Error("iterable cannot be null.");if(t&&!v(t))throw new Error("mapFn when provided must be a function");if(t)var u=ut(t,i,2);return tt(r)||(r=it),new ws(n,u,r)};vi=function(n){function t(t,i){this.args=t;this.scheduler=i;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new bu(n,this);return t.run()},t}(w);bu.prototype.run=function(){function i(i,u){r>i?(n.onNext(t[i]),u(i+1)):n.onCompleted()}var n=this.observer,t=this.parent.args,r=t.length;return this.parent.scheduler.scheduleRecursiveWithState(0,i)};fe=u.fromArray=function(n,t){return tt(t)||(t=it),new vi(n,t)};u.generate=function(n,t,i,u,f){return tt(f)||(f=it),new r(function(r){var e=!0;return f.scheduleRecursiveWithState(n,function(n,f){var o,s;try{e?e=!1:n=i(n);o=t(n);o&&(s=u(n))}catch(h){return r.onError(h)}o?(r.onNext(s),f(n)):r.onCompleted()})})};ee=function(n){function t(){n.call(this)}return c(t,n),t.prototype.subscribeCore=function(){return g},t}(w);oe=u.never=function(){return new ee};u.of=function(){for(var t=arguments.length,i=new Array(t),n=0;t>n;n++)i[n]=arguments[n];return new vi(i,it)};u.ofWithScheduler=function(n){for(var i=arguments.length,r=new Array(i-1),t=1;i>t;t++)r[t-1]=arguments[t];return new vi(r,n)};se=function(n){function t(t,i){this.obj=t;this.keys=Object.keys(t);this.scheduler=i;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new du(n,this);return t.run()},t}(w);du.prototype.run=function(){function i(i,f){if(u>i){var e=t[i];n.onNext([e,r[e]]);f(i+1)}else n.onCompleted()}var n=this.observer,r=this.parent.obj,t=this.parent.keys,u=t.length;return this.parent.scheduler.scheduleRecursiveWithState(0,i)};u.pairs=function(n,t){return t||(t=it),new se(n,t)};he=function(n){function t(t,i,r){this.start=t;this.count=i;this.scheduler=r;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new ce(n,this);return t.run()},t}(w);ce=function(){function n(n,t){this.observer=n;this.parent=t}return n.prototype.run=function(){function t(t,u){r>t?(n.onNext(i+t),u(t+1)):n.onCompleted()}var i=this.parent.start,r=this.parent.count,n=this.observer;return this.parent.scheduler.scheduleRecursiveWithState(0,t)},n}();u.range=function(n,t,i){return tt(i)||(i=it),new he(n,t,i)};le=function(n){function t(t,i,r){this.value=t;this.repeatCount=null==i?-1:i;this.scheduler=r;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new gu(n,this);return t.run()},t}(w);gu.prototype.run=function(){function t(t,r){return(-1===t||t>0)&&(n.onNext(i),t>0&&t--),0===t?n.onCompleted():void r(t)}var n=this.observer,i=this.parent.value;return this.parent.scheduler.scheduleRecursiveWithState(this.parent.repeatCount,t)};u.repeat=function(n,t,i){return tt(i)||(i=it),new le(n,t,i)};var ks=function(n){function t(t,i){this.value=t;this.scheduler=i;n.call(this)}function i(n,t){this.observer=n;this.parent=t}function r(n,t){var r=t[0],i=t[1];i.onNext(r);i.onCompleted()}return c(t,n),t.prototype.subscribeCore=function(n){var t=new i(n,this);return t.run()},i.prototype.run=function(){return this.parent.scheduler.scheduleWithState([this.parent.value,this.observer],r)},t}(w),ds=(u["return"]=u.just=u.returnValue=function(n,t){return tt(t)||(t=et),new ks(n,t)},function(n){function t(t,i){this.error=t;this.scheduler=i;n.call(this)}function i(n,t){this.observer=n;this.parent=t}function r(n,t){var i=t[0],r=t[1];r.onError(i)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new i(n,this);return t.run()},i.prototype.run=function(){return this.parent.scheduler.scheduleWithState([this.parent.error,this.observer],r)},t}(w)),ae=u["throw"]=u.throwError=u.throwException=function(n,t){return tt(t)||(t=et),new ds(n,t)};u.using=function(n,t){return new r(function(i){var r,f,u=g;try{r=n();r&&(u=r);f=t(r)}catch(e){return new l(ae(e).subscribe(i),u)}return new l(f.subscribe(i),u)})};t.amb=function(n){var t=this;return new r(function(i){function s(){r||(r=u,v.dispose())}function c(){r||(r=f,a.dispose())}var r,u="L",f="R",a=new e,v=new e;return h(n)&&(n=o(n)),a.setDisposable(t.subscribe(function(n){s();r===u&&i.onNext(n)},function(n){s();r===u&&i.onError(n)},function(){s();r===u&&i.onCompleted()})),v.setDisposable(n.subscribe(function(n){c();r===f&&i.onNext(n)},function(n){c();r===f&&i.onError(n)},function(){c();r===f&&i.onCompleted()})),new l(a,v)})};u.amb=function(){function u(n,t){return n.amb(t)}var r=oe(),t=[],n,i;if(Array.isArray(arguments[0]))t=arguments[0];else for(n=0,i=arguments.length;i>n;n++)t.push(arguments[n]);for(n=0,i=t.length;i>n;n++)r=u(r,t[n]);return r};t["catch"]=t.catchError=t.catchException=function(n){return"function"==typeof n?vo(this,n):ve([this,n])};ve=u.catchError=u["catch"]=u.catchException=function(){var t=[],n,i;if(Array.isArray(arguments[0]))t=arguments[0];else for(n=0,i=arguments.length;i>n;n++)t.push(arguments[n]);return iu(t).catchError()};t.combineLatest=function(){for(var i=arguments.length,n=new Array(i),t=0;i>t;t++)n[t]=arguments[t];return Array.isArray(n[0])?n[0].unshift(this):n.unshift(this),ye.apply(this,n)};ye=u.combineLatest=function(){for(var u,i=arguments.length,n=new Array(i),t=0;i>t;t++)n[t]=arguments[t];return u=n.pop(),Array.isArray(n[0])&&(n=n[0]),new r(function(t){function p(n){if(c[n]=!0,a||(a=c.every(wt))){try{var i=u.apply(null,v)}catch(f){return t.onError(f)}t.onNext(i)}else r.filter(function(t,i){return i!==n}).every(wt)&&t.onCompleted()}function w(n){r[n]=!0;r.every(wt)&&t.onCompleted()}for(var i=n.length,s=function(){return!1},c=pt(i,s),a=!1,r=pt(i,s),v=new Array(i),y=new Array(i),f=0;i>f;f++)!function(i){var r=n[i],u=new e;h(r)&&(r=o(r));u.setDisposable(r.subscribe(function(n){v[i]=n;p(i)},function(n){t.onError(n)},function(){w(i)}));y[i]=u}(f);return new l(y)},this)};t.concat=function(){for(var n=[],t=0,i=arguments.length;i>t;t++)n.push(arguments[t]);return n.unshift(this),pe.apply(null,n)};pe=u.concat=function(){var t,n,i;if(Array.isArray(arguments[0]))t=arguments[0];else for(t=new Array(arguments.length),n=0,i=arguments.length;i>n;n++)t[n]=arguments[n];return iu(t).concat()};t.concatAll=t.concatObservable=function(){return this.merge(1)};we=function(n){function t(t,i){this.source=t;this.maxConcurrent=i;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new l;return t.add(this.source.subscribe(new be(n,this.maxConcurrent,t))),t},t}(w);be=function(){function n(n,t,i){this.o=n;this.max=t;this.g=i;this.done=!1;this.q=[];this.activeCount=0;this.isStopped=!1}function t(n,t){this.parent=n;this.sad=t;this.isStopped=!1}return n.prototype.handleSubscribe=function(n){var i=new e;this.g.add(i);h(n)&&(n=o(n));i.setDisposable(n.subscribe(new t(this,i)))},n.prototype.onNext=function(n){this.isStopped||(this.activeCount<this.max?(this.activeCount++,this.handleSubscribe(n)):this.q.push(n))},n.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.o.onError(n))},n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,0===this.activeCount&&this.o.onCompleted())},n.prototype.dispose=function(){this.isStopped=!0},n.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(n),!0)},t.prototype.onNext=function(n){this.isStopped||this.parent.o.onNext(n)},t.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.parent.o.onError(n))},t.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=!0;var n=this.parent;n.g.remove(this.sad);n.q.length>0?n.handleSubscribe(n.q.shift()):(n.activeCount--,n.done&&0===n.activeCount&&n.o.onCompleted())}},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(n),!0)},n}();t.merge=function(n){return"number"!=typeof n?gs(this,n):new we(this,n)};var gs=u.merge=function(){var i,n,t=[],r=arguments.length;if(arguments[0])if(tt(arguments[0]))for(i=arguments[0],n=1;r>n;n++)t.push(arguments[n]);else for(i=et,n=0;r>n;n++)t.push(arguments[n]);else for(i=et,n=1;r>n;n++)t.push(arguments[n]);return Array.isArray(t[0])&&(t=t[0]),ku(i,t).mergeAll()},nh=function(n){function t(t){this.source=t;n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){var t=new l,i=new e;return t.add(i),i.setDisposable(this.source.subscribe(new th(n,t))),t},t}(w),th=function(){function n(n,t){this.o=n;this.g=t;this.isStopped=!1;this.done=!1}function t(n,t,i){this.parent=n;this.g=t;this.sad=i;this.isStopped=!1}return n.prototype.onNext=function(n){if(!this.isStopped){var i=new e;this.g.add(i);h(n)&&(n=o(n));i.setDisposable(n.subscribe(new t(this,this.g,i)))}},n.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.o.onError(n))},n.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.done=!0,1===this.g.length&&this.o.onCompleted())},n.prototype.dispose=function(){this.isStopped=!0},n.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.o.onError(n),!0)},t.prototype.onNext=function(n){this.isStopped||this.parent.o.onNext(n)},t.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.parent.o.onError(n))},t.prototype.onCompleted=function(){if(!this.isStopped){var n=this.parent;this.isStopped=!0;n.g.remove(this.sad);n.done&&1===n.g.length&&n.o.onCompleted()}},t.prototype.dispose=function(){this.isStopped=!0},t.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.parent.o.onError(n),!0)},n}();t.mergeAll=t.mergeObservable=function(){return new nh(this)};fu=i.CompositeError=function(n){this.name="NotImplementedError";this.innerErrors=n;this.message="This contains multiple errors. Check the innerErrors";Error.call(this)};fu.prototype=Error.prototype;u.mergeDelayError=function(){var t,i,n,u;if(Array.isArray(arguments[0]))t=arguments[0];else for(i=arguments.length,t=new Array(i),n=0;i>n;n++)t[n]=arguments[n];return u=ku(null,t),new r(function(n){function r(){0===i.length?n.onCompleted():n.onError(1===i.length?i[0]:new fu(i))}var t=new l,s=new e,f=!1,i=[];return t.add(s),s.setDisposable(u.subscribe(function(u){var s=new e;t.add(s);h(u)&&(u=o(u));s.setDisposable(u.subscribe(function(t){n.onNext(t)},function(n){i.push(n);t.remove(s);f&&1===t.length&&r()},function(){t.remove(s);f&&1===t.length&&r()}))},function(n){i.push(n);f=!0;1===t.length&&r()},function(){f=!0;1===t.length&&r()})),t})};t.onErrorResumeNext=function(n){if(!n)throw new Error("Second observable is required");return ke([this,n])};ke=u.onErrorResumeNext=function(){var n=[],t,i;if(Array.isArray(arguments[0]))n=arguments[0];else for(t=0,i=arguments.length;i>t;t++)n.push(arguments[t]);return new r(function(t){var i=0,r=new nt,u=et.scheduleRecursive(function(u){var f,s;i<n.length?(f=n[i++],h(f)&&(f=o(f)),s=new e,r.setDisposable(s),s.setDisposable(f.subscribe(t.onNext.bind(t),u,u))):t.onCompleted()});return new l(r,u)})};t.skipUntil=function(n){var t=this;return new r(function(i){var u=!1,f=new l(t.subscribe(function(n){u&&i.onNext(n)},function(n){i.onError(n)},function(){u&&i.onCompleted()})),r;return h(n)&&(n=o(n)),r=new e,f.add(r),r.setDisposable(n.subscribe(function(){u=!0;r.dispose()},function(n){i.onError(n)},function(){r.dispose()})),f},t)};t["switch"]=t.switchLatest=function(){var n=this;return new r(function(t){var r=!1,u=new nt,f=!1,i=0,s=n.subscribe(function(n){var c=new e,s=++i;r=!0;u.setDisposable(c);h(n)&&(n=o(n));c.setDisposable(n.subscribe(function(n){i===s&&t.onNext(n)},function(n){i===s&&t.onError(n)},function(){i===s&&(r=!1,f&&t.onCompleted())}))},function(n){t.onError(n)},function(){f=!0;r||t.onCompleted()});return new l(s,u)},n)};t.takeUntil=function(n){var t=this;return new r(function(i){return h(n)&&(n=o(n)),new l(t.subscribe(i),n.subscribe(function(){i.onCompleted()},function(n){i.onError(n)},k))},t)};t.withLatestFrom=function(){for(var i,u,f=arguments.length,n=new Array(f),t=0;f>t;t++)n[t]=arguments[t];if(i=n.pop(),u=this,"undefined"==typeof u)throw new Error("Source observable not found for withLatestFrom().");if("function"!=typeof i)throw new Error("withLatestFrom() expects a resultSelector function.");return Array.isArray(n[0])&&(n=n[0]),new r(function(t){for(var c,p=function(){return!1},r=n.length,a=pt(r,p),v=!1,y=new Array(r),f=new Array(r+1),s=0;r>s;s++)!function(i){var r=n[i],u=new e;h(r)&&(r=o(r));u.setDisposable(r.subscribe(function(n){y[i]=n;a[i]=!0;v=a.every(wt)},t.onError.bind(t),function(){}));f[i]=u}(s);return c=new e,c.setDisposable(u.subscribe(function(n){var r,u=[n].concat(y);if(v){try{r=i.apply(null,u)}catch(f){return void t.onError(f)}t.onNext(r)}},t.onError.bind(t),function(){t.onCompleted()})),f[r]=c,new l(f)},this)};t.zip=function(){var i,f;if(Array.isArray(arguments[0]))return yo.apply(this,arguments);for(var u=arguments.length,n=new Array(u),t=0;u>t;t++)n[t]=arguments[t];return i=this,f=n.pop(),n.unshift(i),new r(function(t){function v(n){var r,e;if(u.every(function(n){return n.length>0})){try{e=u.map(function(n){return n.shift()});r=f.apply(i,e)}catch(o){return void t.onError(o)}t.onNext(r)}else s.filter(function(t,i){return i!==n}).every(wt)&&t.onCompleted()}function y(n){s[n]=!0;s.every(function(n){return n})&&t.onCompleted()}for(var r=n.length,u=pt(r,wo),s=pt(r,po),a=new Array(r),c=0;r>c;c++)!function(i){var r=n[i],f=new e;h(r)&&(r=o(r));f.setDisposable(r.subscribe(function(n){u[i].push(n);v(i)},function(n){t.onError(n)},function(){y(i)}));a[i]=f}(c);return new l(a)},i)};u.zip=function(){for(var i,r=arguments.length,t=new Array(r),n=0;r>n;n++)t[n]=arguments[n];return i=t.shift(),i.zip.apply(i,t)};u.zipArray=function(){var n,i,t;if(Array.isArray(arguments[0]))n=arguments[0];else for(i=arguments.length,n=new Array(i),t=0;i>t;t++)n[t]=arguments[t];return new r(function(t){function s(n){if(r.every(function(n){return n.length>0})){var i=r.map(function(n){return n.shift()});t.onNext(i)}else if(u.filter(function(t,i){return i!==n}).every(wt))return void t.onCompleted()}function h(n){return u[n]=!0,u.every(wt)?void t.onCompleted():void 0}for(var i=n.length,r=pt(i,function(){return[]}),u=pt(i,function(){return!1}),f=new Array(i),o=0;i>o;o++)!function(i){f[i]=new e;f[i].setDisposable(n[i].subscribe(function(n){r[i].push(n);s(i)},function(n){t.onError(n)},function(){h(i)}))}(o);return new l(f)})};t.asObservable=function(){var n=this;return new r(function(t){return n.subscribe(t)},this)};t.bufferWithCount=function(n,t){return"number"!=typeof t&&(t=n),this.windowWithCount(n,t).selectMany(function(n){return n.toArray()}).where(function(n){return n.length>0})};t.dematerialize=function(){var n=this;return new r(function(t){return n.subscribe(function(n){return n.accept(t)},function(n){t.onError(n)},function(){t.onCompleted()})},this)};t.distinctUntilChanged=function(n,t){var i=this;return t||(t=ff),new r(function(r){var f,u=!1;return i.subscribe(function(i){var e=i,s;if(n)try{e=n(i)}catch(o){return void r.onError(o)}if(u)try{s=t(f,e)}catch(o){return void r.onError(o)}u&&s||(u=!0,f=e,r.onNext(i))},function(n){r.onError(n)},function(){r.onCompleted()})},this)};t["do"]=t.tap=t.doAction=function(n,t,i){var u=this;return new r(function(r){var f=!n||v(n)?fi(n||k,t||k,i||k):n;return u.subscribe(function(n){try{f.onNext(n)}catch(t){r.onError(t)}r.onNext(n)},function(n){try{f.onError(n)}catch(t){r.onError(t)}r.onError(n)},function(){try{f.onCompleted()}catch(n){r.onError(n)}r.onCompleted()})},this)};t.doOnNext=t.tapOnNext=function(n,t){return this.tap("undefined"!=typeof t?function(i){n.call(t,i)}:n)};t.doOnError=t.tapOnError=function(n,t){return this.tap(k,"undefined"!=typeof t?function(i){n.call(t,i)}:n)};t.doOnCompleted=t.tapOnCompleted=function(n,t){return this.tap(k,null,"undefined"!=typeof t?function(){n.call(t)}:n)};t["finally"]=t.ensure=function(n){var t=this;return new r(function(i){var r;try{r=t.subscribe(i)}catch(u){throw n(),u;}return ht(function(){try{r.dispose()}catch(t){throw t;}finally{n()}})},this)};t.finallyAction=function(n){return this.ensure(n)};t.ignoreElements=function(){var n=this;return new r(function(t){return n.subscribe(k,function(n){t.onError(n)},function(){t.onCompleted()})},n)};t.materialize=function(){var n=this;return new r(function(t){return n.subscribe(function(n){t.onNext(gf(n))},function(n){t.onNext(ne(n));t.onCompleted()},function(){t.onNext(te());t.onCompleted()})},n)};t.repeat=function(n){return tu(this,n).concat()};t.retry=function(n){return tu(this,n).catchError()};t.retryWhen=function(n){return tu(this).catchErrorWhen(n)};t.scan=function(){var t,n,i=!1,u=this;return 2===arguments.length?(i=!0,t=arguments[0],n=arguments[1]):n=arguments[0],new r(function(r){var o,f,e;return u.subscribe(function(u){e||(e=!0);try{o?f=n(f,u):(f=i?n(t,u):u,o=!0)}catch(s){return void r.onError(s)}r.onNext(f)},function(n){r.onError(n)},function(){!e&&i&&r.onNext(t);r.onCompleted()})},u)};t.skipLast=function(n){if(0>n)throw new vt;var t=this;return new r(function(i){var r=[];return t.subscribe(function(t){r.push(t);r.length>n&&i.onNext(r.shift())},function(n){i.onError(n)},function(){i.onCompleted()})},t)};t.startWith=function(){var n,i=0;arguments.length&&tt(arguments[0])?(n=arguments[0],i=1):n=et;for(var r=[],t=i,u=arguments.length;u>t;t++)r.push(arguments[t]);return iu([fe(r,n),this]).concat()};t.takeLast=function(n){if(0>n)throw new vt;var t=this;return new r(function(i){var r=[];return t.subscribe(function(t){r.push(t);r.length>n&&r.shift()},function(n){i.onError(n)},function(){for(;r.length>0;)i.onNext(r.shift());i.onCompleted()})},t)};t.takeLastBuffer=function(n){var t=this;return new r(function(i){var r=[];return t.subscribe(function(t){r.push(t);r.length>n&&r.shift()},function(n){i.onError(n)},function(){i.onNext(r);i.onCompleted()})},t)};t.windowWithCount=function(n,t){var i=this;if(+n||(n=0),Math.abs(n)===1/0&&(n=0),0>=n)throw new vt;if(null==t&&(t=n),+t||(t=0),Math.abs(t)===1/0&&(t=0),0>=t)throw new vt;return new r(function(r){function f(){var n=new sr;u.push(n);r.onNext(es(n,s))}var o=new e,s=new kf(o),h=0,u=[];return f(),o.setDisposable(i.subscribe(function(i){for(var e,r=0,o=u.length;o>r;r++)u[r].onNext(i);e=h-n+1;e>=0&&e%t==0&&u.shift().onCompleted();++h%t==0&&f()},function(n){for(;u.length>0;)u.shift().onError(n);r.onError(n)},function(){for(;u.length>0;)u.shift().onCompleted();r.onCompleted()})),s},i)};t.selectConcat=t.concatMap=function(n,t,i){return v(n)&&v(t)?this.concatMap(function(i,r){var u=n(i,r);return h(u)&&(u=o(u)),(tr(u)||nr(u))&&(u=ai(u)),u.map(function(n,u){return t(i,n,r,u)})}):v(n)?nf(this,n,i):nf(this,function(){return n})};t.concatMapObserver=t.selectConcatObserver=function(n,t,i,u){var f=this,e=ut(n,u,2),s=ut(t,u,1),c=ut(i,u,0);return new r(function(n){var t=0;return f.subscribe(function(i){var r;try{r=e(i,t++)}catch(u){return void n.onError(u)}h(r)&&(r=o(r));n.onNext(r)},function(t){var i;try{i=s(t)}catch(r){return void n.onError(r)}h(i)&&(i=o(i));n.onNext(i);n.onCompleted()},function(){var t;try{t=c()}catch(i){return void n.onError(i)}h(t)&&(t=o(t));n.onNext(t);n.onCompleted()})},this).concatAll()};t.defaultIfEmpty=function(t){var i=this;return t===n&&(t=null),new r(function(n){var r=!1;return i.subscribe(function(t){r=!0;n.onNext(t)},function(t){n.onError(t)},function(){r||n.onNext(t);n.onCompleted()})},i)};tf.prototype.push=function(n){var t=-1===bo(this.set,n,this.comparer);return t&&this.set.push(n),t};t.distinct=function(n,t){var i=this;return t||(t=ff),new r(function(r){var u=new tf(t);return i.subscribe(function(t){var i=t;if(n)try{i=n(t)}catch(f){return void r.onError(f)}u.push(i)&&r.onNext(t)},function(n){r.onError(n)},function(){r.onCompleted()})},this)};eu=function(n){function t(t,i,r){this.source=t;this.selector=ut(i,r,3);n.call(this)}return c(t,n),t.prototype.internalMap=function(n,i){var r=this;return new t(this.source,function(t,i,u){return n.call(this,r.selector(t,i,u),i,u)},i)},t.prototype.subscribeCore=function(n){return this.source.subscribe(new gt(n,this.selector,this))},t}(w);gt.prototype.onNext=function(n){if(!this.isStopped){var t=b(this.selector).call(this,n,this.i++,this.source);return t===a?this.observer.onError(t.e):void this.observer.onNext(t)}};gt.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.observer.onError(n))};gt.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.observer.onCompleted())};gt.prototype.dispose=function(){this.isStopped=!0};gt.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(n),!0)};t.map=t.select=function(n,t){var i="function"==typeof n?n:function(){return n};return this instanceof eu?this.internalMap(i,t):new eu(this,i,t)};t.pluck=function(){var i=arguments,t=arguments.length;if(0===t)throw new Error("List of properties cannot be empty.");return this.map(function(r){for(var e,u=r,f=0;t>f;f++){if(e=u[i[f]],"undefined"==typeof e)return n;u=e}return u})};t.selectMany=t.flatMap=function(n,t,i){return v(n)&&v(t)?this.flatMap(function(i,r){var u=n(i,r);return h(u)&&(u=o(u)),(tr(u)||nr(u))&&(u=ai(u)),u.map(function(n,u){return t(i,n,r,u)})},i):v(n)?rf(this,n,i):rf(this,function(){return n})};t.flatMapObserver=t.selectManyObserver=function(n,t,i,u){var f=this;return new r(function(r){var e=0;return f.subscribe(function(t){var i;try{i=n.call(u,t,e++)}catch(f){return void r.onError(f)}h(i)&&(i=o(i));r.onNext(i)},function(n){var i;try{i=t.call(u,n)}catch(f){return void r.onError(f)}h(i)&&(i=o(i));r.onNext(i);r.onCompleted()},function(){var n;try{n=i.call(u)}catch(t){return void r.onError(t)}h(n)&&(n=o(n));r.onNext(n);r.onCompleted()})},f).mergeAll()};t.selectSwitch=t.flatMapLatest=t.switchMap=function(n,t){return this.select(n,t).switchLatest()};t.skip=function(n){if(0>n)throw new vt;var t=this;return new r(function(i){var r=n;return t.subscribe(function(n){0>=r?i.onNext(n):r--},function(n){i.onError(n)},function(){i.onCompleted()})},t)};t.skipWhile=function(n,t){var i=this,u=ut(n,t,3);return new r(function(n){var r=0,t=!1;return i.subscribe(function(f){if(!t)try{t=!u(f,r++,i)}catch(e){return void n.onError(e)}t&&n.onNext(f)},function(t){n.onError(t)},function(){n.onCompleted()})},i)};t.take=function(n,t){if(0>n)throw new vt;if(0===n)return ps(t);var i=this;return new r(function(t){var r=n;return i.subscribe(function(n){r-->0&&(t.onNext(n),0===r&&t.onCompleted())},function(n){t.onError(n)},function(){t.onCompleted()})},i)};t.takeWhile=function(n,t){var i=this,u=ut(n,t,3);return new r(function(n){var r=0,t=!0;return i.subscribe(function(f){if(t){try{t=u(f,r++,i)}catch(e){return void n.onError(e)}t?n.onNext(f):n.onCompleted()}},function(t){n.onError(t)},function(){n.onCompleted()})},i)};ou=function(n){function t(t,i,r){this.source=t;this.predicate=ut(i,r,3);n.call(this)}return c(t,n),t.prototype.subscribeCore=function(n){return this.source.subscribe(new ni(n,this.predicate,this))},t.prototype.internalFilter=function(n,i){var r=this;return new t(this.source,function(t,i,u){return r.predicate(t,i,u)&&n.call(this,t,i,u)},i)},t}(w);ni.prototype.onNext=function(n){if(!this.isStopped){var t=b(this.predicate).call(this,n,this.i++,this.source);return t===a?this.observer.onError(t.e):void(t&&this.observer.onNext(n))}};ni.prototype.onError=function(n){this.isStopped||(this.isStopped=!0,this.observer.onError(n))};ni.prototype.onCompleted=function(){this.isStopped||(this.isStopped=!0,this.observer.onCompleted())};ni.prototype.dispose=function(){this.isStopped=!0};ni.prototype.fail=function(n){return this.isStopped?!1:(this.isStopped=!0,this.observer.onError(n),!0)};t.filter=t.where=function(n,t){return this instanceof ou?this.internalFilter(n,t):new ou(this,n,t)};t.transduce=function(n){function i(n){return{"@@transducer/init":function(){return n},"@@transducer/step":function(n,t){return n.onNext(t)},"@@transducer/result":function(n){return n.onCompleted()}}}var t=this;return new r(function(r){var u=n(i(r));return t.subscribe(function(n){try{u["@@transducer/step"](r,n)}catch(t){r.onError(t)}},function(n){r.onError(n)},function(){u["@@transducer/result"](r)})},t)};var r=i.AnonymousObservable=function(n){function r(n){return n&&v(n.dispose)?n:v(n)?ht(n):g}function t(n,t){var i=t[0],f=t[1],u=b(f)(i);return u!==a||i.fail(a.e)?void i.setDisposable(r(u)):ot(a.e)}function i(i,r){function u(n){var r=new de(n),u=[r,i];return it.scheduleRequired()?it.scheduleWithState(u,t):t(null,u),r}this.source=r;n.call(this,u)}return c(i,n),i}(u),de=function(n){function i(t){n.call(this);this.observer=t;this.m=new e}c(i,n);var t=i.prototype;return t.next=function(n){var t=b(this.observer.onNext).call(this.observer,n);t===a&&(this.dispose(),ot(t.e))},t.error=function(n){var t=b(this.observer.onError).call(this.observer,n);this.dispose();t===a&&ot(t.e)},t.completed=function(){var n=b(this.observer.onCompleted).call(this.observer);this.dispose();n===a&&ot(n.e)},t.setDisposable=function(n){this.m.setDisposable(n)},t.getDisposable=function(){return this.m.getDisposable()},t.dispose=function(){n.prototype.dispose.call(this);this.m.dispose()},i}(ru),su=function(n,t){this.subject=n;this.observer=t};su.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var n=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(n,1);this.observer=null}};sr=i.Subject=function(n){function i(n){return ct(this),this.isStopped?this.hasError?(n.onError(this.error),g):(n.onCompleted(),g):(this.observers.push(n),new su(this,n))}function t(){n.call(this,i);this.isDisposed=!1;this.isStopped=!1;this.observers=[];this.hasError=!1}return c(t,n),br(t.prototype,rt.prototype,{hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(ct(this),!this.isStopped){this.isStopped=!0;for(var n=0,t=ei(this.observers),i=t.length;i>n;n++)t[n].onCompleted();this.observers.length=0}},onError:function(n){if(ct(this),!this.isStopped){this.isStopped=!0;this.error=n;this.hasError=!0;for(var t=0,i=ei(this.observers),r=i.length;r>t;t++)i[t].onError(n);this.observers.length=0}},onNext:function(n){if(ct(this),!this.isStopped)for(var t=0,i=ei(this.observers),r=i.length;r>t;t++)i[t].onNext(n)},dispose:function(){this.isDisposed=!0;this.observers=null}}),t.create=function(n,t){return new ge(n,t)},t}(u);ge=(i.AsyncSubject=function(n){function i(n){return ct(this),this.isStopped?(this.hasError?n.onError(this.error):this.hasValue?(n.onNext(this.value),n.onCompleted()):n.onCompleted(),g):(this.observers.push(n),new su(this,n))}function t(){n.call(this,i);this.isDisposed=!1;this.isStopped=!1;this.hasValue=!1;this.observers=[];this.hasError=!1}return c(t,n),br(t.prototype,rt,{hasObservers:function(){return ct(this),this.observers.length>0},onCompleted:function(){var n,t,i,r;if(ct(this),!this.isStopped){if(this.isStopped=!0,t=ei(this.observers),i=t.length,this.hasValue)for(n=0;i>n;n++)r=t[n],r.onNext(this.value),r.onCompleted();else for(n=0;i>n;n++)t[n].onCompleted();this.observers.length=0}},onError:function(n){if(ct(this),!this.isStopped){this.isStopped=!0;this.hasError=!0;this.error=n;for(var t=0,i=ei(this.observers),r=i.length;r>t;t++)i[t].onError(n);this.observers.length=0}},onNext:function(n){ct(this);this.isStopped||(this.value=n,this.hasValue=!0)},dispose:function(){this.isDisposed=!0;this.observers=null;this.exception=null;this.value=null}}),t}(u),i.AnonymousSubject=function(n){function i(n){return this.observable.subscribe(n)}function t(t,r){this.observer=t;this.observable=r;n.call(this,i)}return c(t,n),br(t.prototype,rt.prototype,{onCompleted:function(){this.observer.onCompleted()},onError:function(n){this.observer.onError(n)},onNext:function(n){this.observer.onNext(n)}}),t}(u));"function"==typeof define&&"object"==typeof define.amd&&define.amd?(f.Rx=i,define(function(){return i})):pi&&wi?uf?(wi.exports=i).Rx=i:pi.Rx=i:f.Rx=i;no=hu()}).call(this),function(n){var r={boolean:!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},t=r[typeof window]&&window||this,u=r[typeof exports]&&exports&&!exports.nodeType&&exports,f=r[typeof module]&&module&&!module.nodeType&&module,i=(f&&f.exports===u&&u,r[typeof global]&&global);i&&(i.global===i||i.window===i)&&(t=i);"function"==typeof define&&define.amd?define(["rx"],function(i,r){return n(t,r,i)}):"object"==typeof module&&module&&module.exports===u?module.exports=n(t,module.exports,require("./rx")):t.Rx=n(t,{},t.Rx)}.call(this,function(n,t,i){function f(n){for(var i=n.length,r=new Array(i),t=0;i>t;t++)r[t]=n[t];return r}var e=i.Observable,r=e.prototype,o=i.AnonymousObservable,l=i.Subject,a=i.AsyncSubject,v=i.Observer,d=i.internals.ScheduledObserver,y=i.Disposable.create,g=i.Disposable.empty,p=i.CompositeDisposable,nt=i.Scheduler.currentThread,s=i.helpers.isFunction,h=i.internals.inherits,w=i.internals.addProperties,u=i.Disposable.checkDisposed,c;r.multicast=function(n,t){var i=this;return"function"==typeof n?new o(function(r){var u=i.multicast(n());return new p(t(u).subscribe(r),u.connect())},i):new tt(i,n)};r.publish=function(n){return n&&s(n)?this.multicast(function(){return new l},n):this.multicast(new l)};r.share=function(){return this.publish().refCount()};r.publishLast=function(n){return n&&s(n)?this.multicast(function(){return new a},n):this.multicast(new a)};r.publishValue=function(n,t){return 2===arguments.length?this.multicast(function(){return new b(t)},n):this.multicast(new b(n))};r.shareValue=function(n){return this.publishValue(n).refCount()};r.replay=function(n,t,i,r){return n&&s(n)?this.multicast(function(){return new k(t,i,r)},n):this.multicast(new k(t,i,r))};r.shareReplay=function(n,t,i){return this.replay(null,n,t,i).refCount()};c=function(n,t){this.subject=n;this.observer=t};c.prototype.dispose=function(){if(!this.subject.isDisposed&&null!==this.observer){var n=this.subject.observers.indexOf(this.observer);this.subject.observers.splice(n,1);this.observer=null}};var b=i.BehaviorSubject=function(n){function i(n){return u(this),this.isStopped?(this.hasError?n.onError(this.error):n.onCompleted(),g):(this.observers.push(n),n.onNext(this.value),new c(this,n))}function t(t){n.call(this,i);this.value=t;this.observers=[];this.isDisposed=!1;this.isStopped=!1;this.hasError=!1}return h(t,n),w(t.prototype,v,{getValue:function(){if(u(this),this.hasError)throw this.error;return this.value},hasObservers:function(){return this.observers.length>0},onCompleted:function(){if(u(this),!this.isStopped){this.isStopped=!0;for(var n=0,t=f(this.observers),i=t.length;i>n;n++)t[n].onCompleted();this.observers.length=0}},onError:function(n){if(u(this),!this.isStopped){this.isStopped=!0;this.hasError=!0;this.error=n;for(var t=0,i=f(this.observers),r=i.length;r>t;t++)i[t].onError(n);this.observers.length=0}},onNext:function(n){if(u(this),!this.isStopped){this.value=n;for(var t=0,i=f(this.observers),r=i.length;r>t;t++)i[t].onNext(n)}},dispose:function(){this.isDisposed=!0;this.observers=null;this.value=null;this.exception=null}}),t}(e),k=i.ReplaySubject=function(n){function r(n,t){return y(function(){t.dispose();n.isDisposed||n.observers.splice(n.observers.indexOf(t),1)})}function e(n){var t=new d(this.scheduler,n),e=r(this,t),i,f;for(u(this),this._trim(this.scheduler.now()),this.observers.push(t),i=0,f=this.q.length;f>i;i++)t.onNext(this.q[i].value);return this.hasError?t.onError(this.error):this.isStopped&&t.onCompleted(),t.ensureActive(),e}function t(t,r,u){this.bufferSize=null==t?i:t;this.windowSize=null==r?i:r;this.scheduler=u||nt;this.q=[];this.observers=[];this.isStopped=!1;this.isDisposed=!1;this.hasError=!1;this.error=null;n.call(this,e)}var i=Math.pow(2,53)-1;return h(t,n),w(t.prototype,v.prototype,{hasObservers:function(){return this.observers.length>0},_trim:function(n){for(;this.q.length>this.bufferSize;)this.q.shift();for(;this.q.length>0&&n-this.q[0].interval>this.windowSize;)this.q.shift()},onNext:function(n){var t,r;if(u(this),!this.isStopped){t=this.scheduler.now();this.q.push({interval:t,value:n});this._trim(t);for(var i=0,e=f(this.observers),o=e.length;o>i;i++)r=e[i],r.onNext(n),r.ensureActive()}},onError:function(n){var r,i;if(u(this),!this.isStopped){this.isStopped=!0;this.error=n;this.hasError=!0;r=this.scheduler.now();this._trim(r);for(var t=0,e=f(this.observers),o=e.length;o>t;t++)i=e[t],i.onError(n),i.ensureActive();this.observers.length=0}},onCompleted:function(){var i,t;if(u(this),!this.isStopped){this.isStopped=!0;i=this.scheduler.now();this._trim(i);for(var n=0,r=f(this.observers),e=r.length;e>n;n++)t=r[n],t.onCompleted(),t.ensureActive();this.observers.length=0}},dispose:function(){this.isDisposed=!0;this.observers=null}}),t}(e),tt=i.ConnectableObservable=function(n){function t(t,i){var u,r=!1,f=t.asObservable();this.connect=function(){return r||(r=!0,u=new p(f.subscribe(i),y(function(){r=!1}))),u};n.call(this,function(n){return i.subscribe(n)})}return h(t,n),t.prototype.refCount=function(){var n,t=0,i=this;return new o(function(r){var u=1==++t,f=i.subscribe(r);return u&&(n=i.connect()),function(){f.dispose();0==--t&&n.dispose()}})},t}(e);return r.singleInstance=function(){function i(){return n||(n=!0,t=r["finally"](function(){n=!1}).publish().refCount()),t}var t,r=this,n=!1;return new o(function(n){return i().subscribe(n)})},i}),function(n){function t(){return new u}function h(n){return t().resolve(n).promise()}function c(n){return t().reject(n).promise()}function l(n,i){var u=t();return r([],u,n,i),u.promise()}function r(n,t,i,u){var f=i(u);if(!f){t.resolve(n);return}while(f.next&&f.promise.status==2)if(n.push(f.promise.result),f=i(f.next),!f){t.resolve(n);return}f.promise.done(function(u){n.push(u);f.next?r(n,t,i,f.next):t.resolve(n)}).fail(function(n){t.reject(n)})}function v(){for(var n,u,f,i=[],r=0;r<arguments.length;r++)i[+r]=arguments[r];return(n=t(),!i.length)?(n.resolve([]),n.promise()):(u=0,f=[],i.forEach(function(t,r){t.done(function(t){f[r]=t;++u;u===i.length&&n.status!==1&&n.resolve(f)}).fail(function(){n.status!==1&&n.reject(new Error("when: one or more promises were rejected"))})}),n.promise())}function y(n){return function(){return f(n())}}function f(n){return new e(n)}function p(n,i){var r=t();return o(r,n(),i),r.promise()}function o(n,t,i){t.advance().done(function(r){if(!r){n.resolve({});return}i(t.current);o(n,t,i)}).fail(function(t){return n.reject(t)})}function s(n){return typeof n=="undefined"}var a,i,u,e;n.defer=t;n.resolve=h;n.reject=c;n.unfold=l,function(n){n[n.Unfulfilled=0]="Unfulfilled";n[n.Rejected=1]="Rejected";n[n.Resolved=2]="Resolved"}(n.Status||(n.Status={}));a=n.Status;n.when=v;i=function(){function n(n){this.deferred=n}return Object.defineProperty(n.prototype,"status",{get:function(){return this.deferred.status},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"result",{get:function(){return this.deferred.result},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"error",{get:function(){return this.deferred.error},enumerable:!0,configurable:!0}),n.prototype.done=function(n){return this.deferred.done(n),this},n.prototype.fail=function(n){return this.deferred.fail(n),this},n.prototype.always=function(n){return this.deferred.always(n),this},n.prototype.then=function(n){return this.deferred.then(n)},n}();u=function(){function n(){this._resolved=function(){};this._rejected=function(){};this._status=0;this._error={message:""};this._promise=new i(this)}return n.prototype.promise=function(){return this._promise},Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"result",{get:function(){if(this._status!=2)throw new Error("Promise: result not available");return this._result},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"error",{get:function(){if(this._status!=1)throw new Error("Promise: rejection reason not available");return this._error},enumerable:!0,configurable:!0}),n.prototype.then=function(n){var r=t();return this.done(function(t){var u=n(t),f;if(u instanceof i)return f=u,f.done(function(n){return r.resolve(n)}).fail(function(n){return r.reject(n)}),f;r.resolve(u)}).fail(function(n){return r.reject(n)}),r.promise()},n.prototype.done=function(n){if(this.status===2)return n(this._result),this;if(this.status!==0)return this;var t=this._resolved;return this._resolved=function(i){t(i);n(i)},this},n.prototype.fail=function(n){if(this.status===1)return n(this._error),this;if(this.status!==0)return this;var t=this._rejected;return this._rejected=function(i){t(i);n(i)},this},n.prototype.always=function(n){return this.done(function(t){return n(t)}).fail(function(t){return n(null,t)}),this},n.prototype.resolve=function(n){if(this._status!==0)throw new Error("tried to resolve a fulfilled promise");return this._result=n,this._status=2,this._resolved(n),this.detach(),this},n.prototype.reject=function(n){if(this._status!==0)throw new Error("tried to reject a fulfilled promise");return this._error=n,this._status=1,this._rejected(n),this.detach(),this},n.prototype.detach=function(){this._resolved=function(){};this._rejected=function(){}},n}();n.generator=y;n.iterator=f;e=function(){function n(n){this.f=n;this.current=undefined}return n.prototype.advance=function(){var n=this,t=this.f();return t.then(function(t){return s(t)?!1:(n.current=t,!0)})},n}();n.each=p;n.isUndefined=s}(P||(P={})),function(n){var u=function(){function t(n,t,i){var r,u;i===void 0&&(i=!1);r=this;this._onclose=[];u=i?"wss":"ws";this.ws=t!==-1?new WebSocket(u+"://"+n+":"+t+"/"):new WebSocket(u+"://"+n+"/");this.ws.onopen=function(n){r._onopen&&r._onopen(n)};this.ws.onclose=function(n){for(var t=r._onclose.length-1;t>=0;t--)r._onclose[t](n)}}return Object.defineProperty(t.prototype,"onmessage",{set:function(n){this.ws.onmessage=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{set:function(n){this.ws.onerror=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this.ws?this.ws.readyState:n.ConnectivityConsts.CLOSED},enumerable:!0,configurable:!0}),t.prototype.send=function(n){this.ws.send(n)},t.prototype.close=function(n,t){this.ws.close(n,t)},t.prototype.addOnCloseEvtHandler=function(n){this._onclose.push(n)},t.prototype.setOnOpenEvtHandler=function(n){this._onopen=n},t}(),i,t,r;n.NonReconnectingWebSocket=u;i=function(){function t(t,i,r,u,f){f===void 0&&(f=!1);this.url=t;this.port=i;this.endpoint=r;this.settings={debug:!1,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null};this.forcedClose=!1;this.timedOut=!1;this.reconnectAttempts=0;this._readyState=n.ConnectivityConsts.CONNECTING;this.protocol=null;this._onclose=[];this.url=t;this.prefix=f?"wss":"ws";u||(u={});for(var e in u)u.hasOwnProperty(e)&&(this.settings[e]=u[e]);this.open(!1)}return Object.defineProperty(t.prototype,"onmessage",{set:function(n){this.ws.onmessage=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{set:function(n){this.ws.onerror=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this.ws?this.ws.readyState:n.ConnectivityConsts.CLOSED},enumerable:!0,configurable:!0}),t.prototype.send=function(n){if(this.ws)this.log("send",n),this.ws.send(n);else throw"INVALID_STATE_ERR : Pausing to reconnect websocket";},t.prototype.close=function(n,t){typeof n=="undefined"&&(n=1e3);this.forcedClose=!0;this.ws&&this.ws.close(n,t)},t.prototype.addOnCloseEvtHandler=function(n){this._onclose.push(n)},t.prototype.setOnOpenEvtHandler=function(n){this._onopen=n},t.prototype.open=function(t){var i=this,r,u;if(this.endpoint)if(this.port!==-1)throw new Error("Specifying a port is disabled when using endpoints");else this.ws=new WebSocket(this.prefix+"://"+this.url+"/"+this.endpoint+"/");else this.ws=this.port!==-1?new WebSocket(this.prefix+"://"+this.url+":"+this.port+"/"):new WebSocket(this.prefix+"://"+this.url+"/");if(t){if(this.settings.maxReconnectAttempts&&this.reconnectAttempts>this.settings.maxReconnectAttempts)return}else this.reconnectAttempts=0;this.log("attempt-connect");r=this.ws;u=setTimeout(function(){i.log("connection-timeout");i.timedOut=!0;r.close();i.timedOut=!1},this.settings.timeoutInterval);this.ws.onopen=function(){if(clearTimeout(u),i.log("onopen"),i.protocol=i.ws.protocol,i.readyState=n.ConnectivityConsts.OPEN,i.reconnectAttempts=0,i._onopen){var r=i.generateEvent("open");r.isReconnect=t;i._onopen(r)}t=!1};this.ws.onclose=function(){if(clearTimeout(r),i.ws=null,i.forcedClose)i.readyState=n.ConnectivityConsts.CLOSED,i._raiseOnCloseEvent();else{i._readyState=n.ConnectivityConsts.CONNECTING;t||i.timedOut||(i.log("onclose"),i._raiseOnCloseEvent());var r=i.settings.reconnectInterval*Math.pow(i.settings.reconnectDecay,i.reconnectAttempts);setTimeout(function(){i.reconnectAttempts++;i.open(!0)},r>i.settings.maxReconnectInterval?i.settings.maxReconnectInterval:r)}i._onclose=[]}},t.prototype.generateEvent=function(n,t){var i=document.createEvent("CustomEvent");return i.initCustomEvent(n,!1,!1,t),i},t.prototype.log=function(n,i){(this.settings.debug||t.debugAll)&&(i?console.debug("ReconnectingWebSocket",n,this.url,i):console.debug("ReconnectingWebSocket",n,this.url))},t.prototype._raiseOnCloseEvent=function(){for(var t=this.generateEvent("close"),n=this._onclose.length-1;n>=0;n--)this._onclose[n](t)},t.debugAll=!1,t}();n.ReconnectingWebSocket=i;t=function(){function n(){}return n.onNewData=function(n,t){var u=this,i=[],r=[];return t.ROW?(this.state[n]?t.ROW.forEach(function(t){var f=u.state[n].ROW.find(function(n){return n.DETAILS.ROW_REF===t.DETAILS.ROW_REF});f?r.push(t):i.push(t)}):i=t.ROW,this.state[n]=t,{MESSAGE_TYPE:"QUERY_UPDATE",ROW:i.concat(r).concat([]),SOURCE_REF:n}):{MESSAGE_TYPE:"QUERY_UPDATE",ROW:[],SOURCE_REF:n}},n.cleanup=function(n){delete this.state[n]},n.state=[],n}();n.HttpSubscriptionHandler=t;r=function(){function i(n,t,i,r,u,f,e){this.endpoint=n;this.defaultPollingInterval=t;this.pollingIntervalMap=i;this.updateMap=r;this.httpOverride=u;this.defaultTimeout=f;this.timeoutMap=e;this.subscriptionsInfos={};this.logonAcks={};this.srcRefToResourceMap={};this.resourcesToParamsMap={};this.txnToResources=null;r&&(this.txnToResources={});t||(this.defaultPollingInterval=5e3);f||(this.defaultTimeout=1e4);e||(this.timeoutMap={});$.ajaxSetup({cache:!1})}return i.prototype.onmessage=function(){},i.prototype.onerror=function(){},i.prototype.send=function(n){var u=this.defaultTimeout,i=JSON.parse(n),r=i.MESSAGE_TYPE.replace(/_/g,"-").toLowerCase(),f,e;if(i.MESSAGE_TYPE==="HEARTBEAT_PING")this.sendHeartbeatPingMsg(n,i);else if(i.MESSAGE_TYPE==="MORE_COLUMNS"||i.MESSAGE_TYPE==="MORE_ROWS")r=this.srcRefToResourceMap[i.DETAILS.SOURCE_REF].replace(/_/g,"-").toLowerCase(),this.sendMoreRowsOrMoreColumnsMsg(r,n,i);else if(i.MESSAGE_TYPE.indexOf("TXN_")===0){if(this.timeoutMap[i.MESSAGE_TYPE]&&(u=this.timeoutMap[i.MESSAGE_TYPE]),this.sendTxnMsg(r,n,i,u),i.MESSAGE_TYPE==="TXN_LOGOUT"){for(f in this.subscriptionsInfos)clearInterval(this.subscriptionsInfos[f]),delete this.subscriptionsInfos[f],delete this.logonAcks[f];delete this.resourcesToParamsMap}}else if(i.MESSAGE_TYPE.indexOf("DATA_LOGON")===0){if(this.timeoutMap[i.DETAILS.DATASOURCE_NAME]&&(u=this.timeoutMap[i.DETAILS.DATASOURCE_NAME]),r=i.DETAILS.DATASOURCE_NAME.replace(/_/g,"-").toLowerCase(),this.subscriptionsInfos[i.SOURCE_REF])return;this.sendDataLogonMsg(r,n,i,u)}else i.MESSAGE_TYPE.indexOf("DATA_LOGOFF")===0?this.srcRefToResourceMap[i.SOURCE_REF]&&(r=this.srcRefToResourceMap[i.SOURCE_REF].replace(/_/g,"-").toLowerCase(),this.sendDataLogoffMsg(r,n,i),clearInterval(this.subscriptionsInfos[i.SOURCE_REF]),delete this.subscriptionsInfos[i.SOURCE_REF],delete this.logonAcks[i.SOURCE_REF],delete this.srcRefToResourceMap[i.SOURCE_REF],delete this.resourcesToParamsMap[i.SOURCE_REF],t.cleanup(i.SOURCE_REF)):(e=i.MESSAGE_TYPE.replace(/REQ_/g,""),this.timeoutMap[e]&&(u=this.timeoutMap[e]),this.sendGenericGetRequest(r,i,u));console.log("HttpChannel: message sent")},i.prototype.close=function(){},i.prototype.setOnOpenEvtHandler=function(){},i.prototype.addOnCloseEvtHandler=function(){},Object.defineProperty(i.prototype,"readyState",{get:function(){return n.ConnectivityConsts.OPEN},enumerable:!0,configurable:!0}),i.prototype.sendHeartbeatPingMsg=function(n,t){var i=this;$.ajax({url:this.endpoint+"/heartbeat-ping",type:"GET",data:t,headers:{SOURCE_REF:t.SOURCE_REF},contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){i.onmessage({data:JSON.stringify(n)})}).fail(function(n){i.onmessage({data:n.responseText})})},i.prototype.sendMoreRowsOrMoreColumnsMsg=function(n,t,i){var u=this.httpOverride?"POST":"PUT",r={SOURCE_REF:i.SOURCE_REF,SUBSCRIPTION_REF:i.DETAILS.SOURCE_REF,SESSION_AUTH_TOKEN:i.SESSION_AUTH_TOKEN,USER_NAME:i.USER_NAME};this.httpOverride&&(r["X-HTTP-Method-Override"]="PUT");$.ajax({url:this.endpoint+"/"+n,type:u,data:t,headers:r,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){console.log("MORE_ROWS|MORE_COLUMNS success")}).fail(function(){console.log("MORE_ROWS|MORE_COLUMNS failed")})},i.prototype.sendTxnMsg=function(n,t,i,r){var u=this,f={SOURCE_REF:i.SOURCE_REF,SESSION_AUTH_TOKEN:i.SESSION_AUTH_TOKEN,HOSTNAME:i.HOSTNAME,USER_NAME:i.USER_NAME,TIMEOUT:r};n==="txn-logout"&&(f.SESSION_ID=i.SESSION_ID);$.ajax({url:this.endpoint+"/"+n,type:"POST",data:t,headers:f,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){var f,t,e;u.onmessage({data:JSON.stringify(n)});if(u.txnToResources){e=u.txnToResources[i.MESSAGE_TYPE];for(t in u.resourcesToParamsMap)f=u.resourcesToParamsMap[t].DETAILS.DATASOURCE_NAME,f===e&&u.sendDataserverMsg(f.replace(/_/g,"-").toLowerCase(),u.resourcesToParamsMap[t],r)}else for(t in u.resourcesToParamsMap)f=u.resourcesToParamsMap[t].DETAILS.DATASOURCE_NAME,u.sendDataserverMsg(f.replace(/_/g,"-").toLowerCase(),u.resourcesToParamsMap[t],r)}).fail(function(n){switch(n.statusText){case"timeout":u.onmessage({data:JSON.stringify({DETAILS:{ERROR:"Timeout"},MESSAGE_TYPE:"WEBADAPTER_NACK",SOURCE_REF:i.SOURCE_REF})});break;default:u.onmessage({data:n.responseText})}})},i.prototype.sendGenericGetRequest=function(n,t,i){var r=this;$.ajax({url:this.endpoint+"/"+n,type:"GET",data:t,headers:{SOURCE_REF:t.SOURCE_REF,SESSION_AUTH_TOKEN:t.SESSION_AUTH_TOKEN,HOSTNAME:t.HOSTNAME,USER_NAME:t.USER_NAME,TIMEOUT:i},contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){r.onmessage({data:JSON.stringify(n)})}).fail(function(n){var t=n.responseJSON;t.ERROR=[];t.ERROR.push({CODE:t.DETAILS.ERROR});r.onmessage({data:JSON.stringify(t)})})},i.prototype.sendDataLogoffMsg=function(n,t,i){var u=this,f=this.httpOverride?"POST":"DELETE",r={SOURCE_REF:i.SOURCE_REF,SESSION_AUTH_TOKEN:i.SESSION_AUTH_TOKEN,USER_NAME:i.USER_NAME};this.httpOverride&&(r["X-HTTP-Method-Override"]="DELETE");$.ajax({url:this.endpoint+"/"+n,type:f,data:t,headers:r,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){console.log("DATALOG_OFF OK!")}).fail(function(n,t,r){console.log("DELETE failed on "+u.srcRefToResourceMap[i.SOURCE_REF]+" , srcRef="+i.SOURCE_REF);console.log(n);console.log(t);console.log(r)})},i.prototype.sendDataLogonMsg=function(n,t,i,r){var u=this;$.ajax({url:this.endpoint+"/"+n,type:"POST",data:t,headers:{SOURCE_REF:i.SOURCE_REF,SESSION_AUTH_TOKEN:i.SESSION_AUTH_TOKEN,USER_NAME:i.USER_NAME,TIMEOUT:r},contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(t){var f,e;if(!u.logonAcks[i.SOURCE_REF]){u.logonAcks[i.SOURCE_REF]=!0;u.srcRefToResourceMap[i.SOURCE_REF]=i.DETAILS.DATASOURCE_NAME;u.resourcesToParamsMap[i.SOURCE_REF]=i;f=u.pollingIntervalMap?u.pollingIntervalMap[i.DETAILS.DATASOURCE_NAME]||u.defaultPollingInterval:u.defaultPollingInterval;u.timeoutMap[i.DETAILS.DATASOURCE_NAME]&&(r=u.timeoutMap[i.DETAILS.DATASOURCE_NAME]);e=function(){u.sendDataserverMsg(n,i,r)};u.subscriptionsInfos[i.SOURCE_REF]=window.setInterval(e,f);u.onmessage({data:JSON.stringify({MESSAGE_TYPE:"LOGON_ACK",SOURCE_REF:i.SOURCE_REF})})}if(t.ROW&&t.ROW.length>0)u.onmessage({data:JSON.stringify(t)})}).fail(function(n){if(n.statusText==="Unauthorized")u.onmessage({data:JSON.stringify({DETAILS:{ERROR:n.responseJSON.DETAILS.ERROR,MESSAGE_TYPE:"WEBADAPTER_NACK",SOURCE_REF:i.SOURCE_REF}})});else u.onmessage({data:JSON.stringify({DETAILS:{ERROR:"Resource '"+i.DETAILS.DATASOURCE_NAME+"' does not exist."},MESSAGE_TYPE:"WEBADAPTER_NACK",SOURCE_REF:i.SOURCE_REF})})})},i.prototype.sendDataserverMsg=function(n,t,i){var r=this;$.ajax({url:this.endpoint+"/"+n,type:"GET",data:t,headers:{SOURCE_REF:t.SOURCE_REF,SESSION_AUTH_TOKEN:t.SESSION_AUTH_TOKEN,USER_NAME:t.USER_NAME,TIMEOUT:i},contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){if(n.ROW&&n.ROW.length>0)r.onmessage({data:JSON.stringify(n)})}).fail(function(n,i,u){if(n.status===504)r.onmessage({data:JSON.stringify({DETAILS:{ERROR:"Timeout while awaiting a response."},MESSAGE_TYPE:"WEBADAPTER_NACK",SOURCE_REF:t.SOURCE_REF})});else if(u==="Unauthorized")r.onmessage({data:JSON.stringify({DETAILS:{ERROR:n.responseJSON.DETAILS.ERROR},MESSAGE_TYPE:"WEBADAPTER_NACK",SOURCE_REF:t.SOURCE_REF})});else r.onmessage({data:JSON.stringify({DETAILS:{ERROR:"Resource '"+t.DETAILS.DATASOURCE_NAME+"' does not exist."},MESSAGE_TYPE:"WEBADAPTER_NACK",SOURCE_REF:t.SOURCE_REF})})})},i}();n.StatefulHttpChannel=r}(Genesis||(Genesis={})),function(n){var t=function(){function t(n,t,i){this.sourceRefGenerator=n;this.messageBuilder=t;this.networkManager=i}return t.prototype.login=function(n,t){var i,r,u;if(t===void 0&&(t=!1),i=P.defer(),n.credentials.password)this._userName=n.credentials.userName,r=this.sourceRefGenerator.newSourceRef(),u=this.messageBuilder.createLoginMessage(r,n.credentials),this.doLogin(u,i);else return this._userName=n.credentials.userName,this._authToken=n.authToken,this._refreshToken=n.refreshToken,i.resolve({authToken:this.authToken,refreshToken:this._refreshToken,roles:null,permissions:null}),i.promise();return i.promise()},t.prototype.logout=function(){var n=this,i=this.messageBuilder.createLogoutMessage(this.sourceRefGenerator.newSourceRef(),this.authToken,this.userName,this._sessionId),t=P.defer();return this.networkManager.send(i,function(){n._authToken=undefined;n._userName=undefined;n.networkManager.stop();n.networkManager=null;t.resolve(undefined)},function(n){return t.reject(n)}),t.promise()},t.prototype.isLoggedIn=function(){return this._authToken!==undefined},t.prototype.changePassword=function(n,t){var r=this.messageBuilder.createChangePasswordMessage(this.sourceRefGenerator.newSourceRef(),this.authToken,this.userName,n,t),i=P.defer();return this.networkManager.send(r,function(){return i.resolve(undefined)},function(n){return i.reject(n)}),i.promise()},t.prototype.refreshToken=function(){var n=P.defer(),t=this.sourceRefGenerator.newSourceRef(),i=this.messageBuilder.createRefreshTokenMessage(t,this._userName,this._refreshToken);return this.doLogin(i,n),n.promise()},Object.defineProperty(t.prototype,"userName",{get:function(){return this._userName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authToken",{get:function(){return this._authToken},enumerable:!0,configurable:!0}),t.prototype.doLogin=function(t,i){var r=this;this.networkManager.send(t,function(t){var f=t.MESSAGE_TYPE,u;switch(f){case n.Consts.loginAck:r._authToken=t.SESSION_AUTH_TOKEN;r._refreshToken=t.REFRESH_AUTH_TOKEN;r._sessionId=t.SESSION_ID;i.resolve({authToken:t.SESSION_AUTH_TOKEN,refreshToken:t.REFRESH_AUTH_TOKEN,roles:t.PROFILE,permissions:t.PERMISSION});break;case n.Consts.loginNack:case n.Consts.msgNack:i.reject({message:t.ERROR[0].CODE});break;default:u=t;i.reject({message:u.DETAILS.ERROR})}},function(n){return i.reject(n)})},t}();n.AuthManager=t}(Genesis||(Genesis={})),function(n){var t=function(){function n(){}return n.getAllProfilesMessageType="ALL_PROFILES",n.insertProfileMessageType="TXN_INSERT_PROFILE",n.amendProfileMessageType="TXN_AMEND_PROFILE",n.deleteProfileMessageType="TXN_DELETE_PROFILE",n.getAllUsersMessageType="ALL_USERS",n.insertUserMessageType="TXN_INSERT_USER",n.amendUserMessageType="TXN_AMEND_USER",n.deleteUserMessageType="TXN_DELETE_USER",n.userProfiles="TXN_USER_PROFILES",n.profilesUsers="TXN_PROFILE_USERS",n.permissionsUpdates="USER_RIGHTS",n.getAllRightsForAProfile="PROFILE_RIGHTS",n.active="ACTIVE",n.inactive="INACTIVE",n.enabled="ENABLED",n.disabled="DISABLED",n.passwordExpired="PASSWORD_EXPIRED",n.passwordReset="PASSWORD_RESET",n}(),s=function(){function n(n,t){this.dta=n;this.userName=t;this._profiles=new u(this.dta,this.userName);this._users=new f(this.dta,this.userName)}return n.prototype.permissionsUpdates=function(){return this.dta.stream(t.permissionsUpdates)},Object.defineProperty(n.prototype,"profiles",{get:function(){return this._profiles},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"users",{get:function(){return this._users},enumerable:!0,configurable:!0}),n}(),u,f,i,r,e,o;n.AuthZ=s;u=function(){function n(n,t){this.dta=n;this.userName=t}return n.prototype.all=function(){var i=this,n=P.defer(),r=this.dta.stream(t.getAllProfilesMessageType).subscribeOnNext(function(t){n.resolve(t.all.map(function(n){return i.toProfile(n)}));r.dispose()});return n.promise()},n.prototype.insert=function(n){var i,u,f;switch(n.status){case r.Active:i=t.active;break;case r.Inactive:i=t.inactive}return u=[],n.users&&(u=n.users.map(function(n){return{USER_NAME:n}})),f=[],n.rights&&(f=n.rights.map(function(n){return{CODE:n}})),this.dta.commit(t.insertProfileMessageType,{validate:!1,ignoreWarnings:!0,details:{NAME:n.name,DESCRIPTION:n.description,STATUS:i,USER:u,RIGHT:f}})},n.prototype.byName=function(n){return new e(n,this.dta,this.userName)},n.prototype.toProfile=function(n){return{id:n.PROFILE_ID,name:n.NAME,description:n.DESCRIPTION,status:n.STATUS}},n}();f=function(){function n(n,t){this.dta=n;this.userName=t}return n.prototype.all=function(){var i=this,n=P.defer(),r=this.dta.stream(t.getAllUsersMessageType).subscribeOnNext(function(t){n.resolve(t.all.map(function(n){return i.toUser(n)}));r.dispose()});return n.promise()},n.prototype.insert=function(n){var r,u;switch(n.status){case i.Enabled:r=t.enabled;break;case i.Disabled:r=t.disabled;break;case i.PasswordExpired:r=t.passwordExpired;break;case i.PasswordReset:r=t.passwordReset}return u={EMAIL_ADDRESS:n.emailAddress,FIRST_NAME:n.firstName,LAST_NAME:n.lastName,USER_NAME:n.userName,STATUS:r},n.rights&&(u.RIGHT=n.rights.map(function(n){return{CODE:n}})),this.dta.commit(t.insertUserMessageType,{validate:!1,ignoreWarnings:!0,details:u})},n.prototype.byName=function(n){return new o(n,this.dta)},n.prototype.toUser=function(n){return{id:n.USER_ID,userName:n.USER_NAME,email:n.EMAIL_ADDRESS,firstName:n.FIRST_NAME,lastName:n.LAST_NAME,lastLogin:parseInt(n.LAST_LOGIN),status:n.STATUS}},n}(),function(n){n[n.Enabled=t.enabled]="Enabled";n[n.Disabled=t.disabled]="Disabled";n[n.PasswordExpired=t.passwordExpired]="PasswordExpired";n[n.PasswordReset=t.passwordReset]="PasswordReset"}(i=n.UserStatus||(n.UserStatus={})),function(n){n[n.Active=t.active]="Active";n[n.Inactive=t.inactive]="Inactive"}(r=n.ProfileStatus||(n.ProfileStatus={}));e=function(){function n(n,t,i){this.profileName=n;this.dta=t;this.userName=i}return n.prototype.get=function(){var i=this,n=P.defer(),r=this.dta.stream(t.getAllProfilesMessageType,{criteria:"NAME == '"+this.profileName+"'"}).subscribeOnNext(function(t){t.all.length===0?n.reject({message:"No profile has been found with the name '"+i.profileName+"'"}):n.resolve(i.toProfile(t.all[0]));r.dispose()});return n.promise()},n.prototype.amend=function(n){var r=[],i;return n.users&&(r=n.users.map(function(n){return{USER_NAME:n}})),i=[],n.rights&&(i=n.rights.map(function(n){return{CODE:n}})),this.dta.commit(t.amendProfileMessageType,{validate:!1,ignoreWarnings:!0,details:{NAME:n.name,DESCRIPTION:n.description,STATUS:n.status,USER:r,RIGHT:i}})},n.prototype.delete=function(){return this.dta.commit(t.deleteProfileMessageType,{validate:!1,ignoreWarnings:!0,details:{NAME:this.profileName}})},n.prototype.users=function(){return this.dta.commit(t.profilesUsers,{validate:!1,ignoreWarnings:!0,details:{NAME:this.profileName}})},n.prototype.rights=function(){var n=P.defer(),i=this.dta.stream(t.getAllRightsForAProfile,{criteria:"PROFILE_NAME == '"+this.profileName+"'"}).subscribeOnNext(function(t){n.resolve(t.all.map(function(n){return n.RIGHT_ID}));i.dispose()});return n.promise()},n.prototype.toProfile=function(n){return{id:n.PROFILE_ID,name:n.NAME,description:n.DESCRIPTION,status:n.STATUS}},n}();o=function(){function n(n,t){this.userName=n;this.dta=t}return n.prototype.get=function(){var i=this,n=P.defer(),r=this.dta.stream(t.getAllUsersMessageType,{criteria:"USER_NAME == '"+this.userName+"'"}).subscribeOnNext(function(t){t.all.length===0?n.reject({message:"No user has been found with the name '"+i.userName+"'"}):n.resolve(i.toUser(t.all[0]));r.dispose()});return n.promise()},n.prototype.amend=function(n){var i=[];return n.rights&&(i=n.rights.map(function(n){return{CODE:n}})),this.dta.commit(t.amendUserMessageType,{validate:!1,ignoreWarnings:!0,details:{EMAIL_ADDRESS:n.emailAddress,FIRST_NAME:n.firstName,LAST_NAME:n.lastName,USER_NAME:n.userName,STATUS:n.status,RIGHT:i}})},n.prototype.delete=function(){return this.dta.commit(t.deleteUserMessageType,{validate:!1,ignoreWarnings:!0,details:{USER_NAME:this.userName}})},n.prototype.rights=function(){var n=P.defer(),i=this.dta.stream(t.permissionsUpdates,{criteria:"USER_NAME == '"+this.userName+"'"}).subscribeOnNext(function(t){n.resolve(t.all.map(function(n){return n.CODE}));i.dispose()});return n.promise()},n.prototype.profiles=function(){return this.dta.commit(t.userProfiles,{validate:!1,ignoreWarnings:!0,details:{USER_NAME:this.userName}})},n.prototype.toUser=function(n){return{id:n.USER_ID,userName:n.USER_NAME,email:n.EMAIL_ADDRESS,firstName:n.FIRST_NAME,lastName:n.LAST_NAME,lastLogin:parseInt(n.LAST_LOGIN),status:n.STATUS}},n}()}(Genesis||(Genesis={})),function(n){var i=function(){function n(){}return n.loginMessageType="TXN_LOGIN_AUTH",n.loginServiceName="AUTH_MANAGER",n.loginAck="TXN_LOGIN_AUTH_ACK",n.loginNack="TXN_LOGIN_AUTH_NACK",n.permissionsUpdate="PERMISSIONS_UPDATE",n.logoutMessageType="TXN_LOGOUT",n.logoutServiceName="AUTH_MANAGER",n.metadataMessageType="META_REQUEST",n.metadataAck="META_ACK",n.msgNack="MSG_NACK",n.resourcesMessageType="RESOURCES_REQUEST",n.resourceAck="RESOURCES_REQUEST_ACK",n.resourceNack="RESOURCES_REQUEST_NACK",n.transactionAck="TXN_ACK",n.transactionNack="TXN_NACK",n.changePasswordMessageType="TXN_CHANGE_USER_PASSWORD",n.dataLogonMessageType="DATA_LOGON",n.dataLogonParamsMaxRows="MAX_ROWS",n.dataLogonParamsCriteria="CRITERIA_MATCH",n.dataLogonParamsColumns="FIELDS",n.dataLogonParamsOrderBy="ORDER_BY",n.dataLogonAck="LOGON_ACK",n.dataLogonNack="LOGON_NACK",n.dataLogoffMessageType="DATA_LOGOFF",n.queryUpdateMessageType="QUERY_UPDATE",n.queryUpdateInsert="INSERT",n.queryUpdateModify="MODIFY",n.queryUpdateDelete="DELETE",n.shutdown="DATA_LOG_TERMINATED",n.waitForConnectionTimeout=1e3,n}(),t;n.Consts=i;t=function(){function n(){}return n.CONNECTING=typeof WebSocket=="undefined"?0:WebSocket.CONNECTING,n.OPEN=typeof WebSocket=="undefined"?1:WebSocket.OPEN,n.CLOSING=typeof WebSocket=="undefined"?2:WebSocket.CLOSING,n.CLOSED=typeof WebSocket=="undefined"?3:WebSocket.CLOSED,n}();n.ConnectivityConsts=t}(Genesis||(Genesis={}));_this=this,function(n){function t(){var n=P.defer();return n.promise()}function i(){return"xxxxxxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})}function r(n,t){return $.extend(n,t)}n.newPromise=t;n.createGuid=i;n.extend=r;var u;(function(n){n[n.Up=0]="Up";n[n.Down=1]="Down"})(u=n.ServerStatus||(n.ServerStatus={}))}(Genesis||(Genesis={}));String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,_this.lastIndexOf(n,t)===t});String.prototype.endsWith||(String.prototype.endsWith=function(n){return this.indexOf(n,this.length-n.length)!==-1}),function(n){var i=function(){function i(i,r,u,f,e,o){e===void 0&&(e=t.heartbeatInterval);o===void 0&&(o=t.heartbeatTimeout);var s=this;if(this.dta=i,this.sourceRefGenerator=r,this.networkManager=u,this.heartbeatInterval=e,this.heartbeatTimeout=o,this.suppressServerStatusChange=!1,this._serverStatus=n.ServerStatus.Up,this._onServerStatusSubject=new Rx.Subject,this._onResourcesStatusSubject=new Rx.Subject,this.messageBuilder=new n.MessageBuilder,this._resourcesAvailable={},o<=e)throw new Error("'heartbeatTimeout' must be greater than 'heartbeatInterval'");this._serverStatus=f;window.onbeforeunload=function(){s._heartbeatsTimerId&&clearInterval(s._heartbeatsTimerId)}}return i.prototype.start=function(n){this._startHeartbeats();this._listenForResourceUpdates(n)},i.prototype.stop=function(){clearInterval(this._heartbeatsTimerId);this.allProcessesStatusStream&&this.allProcessesStatusStream.dispose()},Object.defineProperty(i.prototype,"onServerStatus",{get:function(){return this._onServerStatusSubject},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onResourcesStatus",{get:function(){return this._onResourcesStatusSubject},enumerable:!0,configurable:!0}),i.prototype.reset=function(t){this.suppressServerStatusChange=!0;this.networkManager=t;this._serverStatus=n.ServerStatus.Up;this._startHeartbeats()},i.prototype._startHeartbeats=function(){var t=this,i=this.messageBuilder.createHeartbeatMessage(this.sourceRefGenerator.newSourceRef());this._heartbeatsTimerId=setInterval(function(){var r=!1;t.dta.isLoggedIn()&&(t.networkManager.send(i,function(){r=!0}),setTimeout(function(){r||t._serverStatus!==n.ServerStatus.Up?r&&t._serverStatus===n.ServerStatus.Down&&(t._serverStatus=n.ServerStatus.Up,t.notifyServerStatusChange()):(t._serverStatus=n.ServerStatus.Down,t.notifyServerStatusChange())},t.heartbeatTimeout))},this.heartbeatInterval)},i.prototype.notifyServerStatusChange=function(){if(this.suppressServerStatusChange)this.suppressServerStatusChange=!1;else this._onServerStatusSubject.onNext(this._serverStatus)},i.prototype._listenForResourceUpdates=function(n){var t=this,i=!0;this.allProcessesStatusStream=n.subscribeOnNext(function(n){var e=[],u=[],f,r;for(n.all=n.all.sort(function(n,t){return n.PROCESS_HOSTNAME<t.PROCESS_HOSTNAME?1:n.PROCESS_HOSTNAME>t.PROCESS_HOSTNAME?-1:0}),f=n.all[0].PROCESS_HOSTNAME,n.all=n.all.filter(function(n){return n.PROCESS_HOSTNAME===f}),r=0;r<n.all.length;r++)t._extractResources(n.all[r],function(n,i){var r={resourceName:n,isAlive:i==="true"};e.push(r);t._resourcesAvailable[n]===undefined?t._resourcesAvailable[n]=r.isAlive:r.isAlive!==t._resourcesAvailable[n]&&(t._resourcesAvailable[n]=r.isAlive,r.isAlive&&u.push(r.resourceName))});if(!i&&u.length>0)t._onResourcesStatusSubject.onNext(u);else i=!1})},i.prototype._extractResources=function(n,t){n.PROCESS_RESOURCES.split(",").filter(function(n){return n!=="null"}).map(function(n){return n.trim()}).forEach(function(i){i!==null&&i!==""&&t(i,n.PROCESS_STATUS)})},i}(),t;n.DefaultResiliencyManager=i;t=function(){function n(){}return n.heartbeatInterval=1e4,n.heartbeatTimeout=12e3,n}()}(Genesis||(Genesis={})),function(n){var t=function(){function t(t,i){if(this.debug=!0,i&&(this.options=i),t?(t.webSocket&&(this.networkManager=new n.NetworkManager(t.webSocket)),t.authManager&&(this.authManager=t.authManager),t.networkManager&&(this.networkManager=t.networkManager),this.sourceRefGenerator=t.sourceRefGenerator?t.sourceRefGenerator:new n.GuidSourceRefGenerator,t.resiliencyManager&&(this.resiliencyManager=t.resiliencyManager),t.resourceManager&&(this.resourceManager=t.resourceManager),this.messageBuilder=t.messageBuilder?t.messageBuilder:new n.MessageBuilder,t.failoverManager&&(this.failoverManager=t.failoverManager)):(this.sourceRefGenerator=new n.GuidSourceRefGenerator,this.messageBuilder=new n.MessageBuilder),i)if(this.options.http){if(this.options.suppressAuth){var r=this.options.version?this.options.endpoint+"/"+this.options.version:this.options.endpoint;this.networkManager=new n.NetworkManager(new n.StatefulHttpChannel(r,this.options.defaultPollingInterval,this.options.pollingIntervalMap,this.options.updateMap,this.options.httpOverride,this.options.defaultTimeout,this.options.timeoutMap));this.networkManager.start();this.resiliencyManager||(this.resiliencyManager=new n.DefaultResiliencyManager(this,this.sourceRefGenerator,this.networkManager,n.ServerStatus.Up));this.authManager={isLoggedIn:function(){return!0},authToken:"TOKEN",userName:"USERNAME",login:null,logout:null,refreshToken:null,changePassword:null};this.resourceManager=new n.ResourceManager(this.resiliencyManager.onResourcesStatus,this.resiliencyManager.onServerStatus,{authToken:"TOKEN",userName:"USERNAME"},this.networkManager,this.sourceRefGenerator)}}else this.options.suppressAuth&&(this.networkManager=this.networkManager||new n.NetworkManager(new n.ReconnectingWebSocket(this.options.wsEndpoint.url,this.options.wsEndpoint.port,null,null,!1)),this.networkManager.start(),this.resiliencyManager||(this.resiliencyManager=new n.DefaultResiliencyManager(this,this.sourceRefGenerator,this.networkManager,n.ServerStatus.Up)),this.authManager={isLoggedIn:function(){return!0},authToken:"TOKEN",userName:"USERNAME",login:null,logout:null,refreshToken:null,changePassword:null},this.resourceManager=new n.ResourceManager(this.resiliencyManager.onResourcesStatus,this.resiliencyManager.onServerStatus,{authToken:"TOKEN",userName:"USERNAME"},this.networkManager,this.sourceRefGenerator),this.startResiliencyManager())}return t.prototype.login=function(t,i,r,u){var f=this,u,e;if(i===void 0&&(i=!1),r===void 0&&(r=!1),this.options&&this.options.suppressAuth)throw new Error("You can't invoke 'login' when suppressAuth is set to true");return this.options&&this.options.http?(u=this.options.version?this.options.endpoint+"/"+this.options.version:this.options.endpoint,this.networkManager=new n.NetworkManager(new n.StatefulHttpChannel(u,this.options.defaultPollingInterval,this.options.pollingIntervalMap,this.options.updateMap,this.options.httpOverride,this.options.defaultTimeout,this.options.timeoutMap)),this.networkManager.start(),this.resiliencyManager||(this.resiliencyManager=new n.DefaultResiliencyManager(this,this.sourceRefGenerator,this.networkManager,n.ServerStatus.Up)),this.authManager=this.authManager||new n.AuthManager(this.sourceRefGenerator,this.messageBuilder,this.networkManager),this.authManager.login(t).then(function(t){f.createResourceManager();f.startResiliencyManager();f.failoverManager=new n.DummyFailoverManager;var i=P.defer();return f.snapshot("ALL_PROCESSES_STATUS",{columns:"ROW_REF"}).then(function(){i.resolve({authToken:t.authToken,refreshToken:t.refreshToken,roles:t.roles,permissions:t.permissions})}).fail(function(n){n.DETAILS.ERROR==="User is not logged in and supplied auth token is invalid."?f.authManager.refreshToken().then(function(n){i.resolve({authToken:n.authToken,refreshToken:n.refreshToken,roles:n.roles,permissions:n.permissions})}).fail(function(){console.log("token renewal failed!");i.reject({message:"token renewal failed"})}):i.resolve({authToken:t.authToken,refreshToken:t.refreshToken,roles:t.roles,permissions:t.permissions})}),i.promise()}).fail(function(n){n.type&&n.type==="error"&&(f.failoverManager=null,f.resourceManager=null,f.authManager=null,f.resiliencyManager.stop(),f.resiliencyManager=null,f.networkManager.stop(),f.networkManager=null)})):(e={reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null},t.resiliencyOptions&&(e.reconnectInterval=t.resiliencyOptions.reconnectInterval,e.maxReconnectInterval=t.resiliencyOptions.maxReconnectInterval,e.reconnectDecay=t.resiliencyOptions.reconnectDecay,e.timeoutInterval=t.resiliencyOptions.timeoutInterval,e.maxReconnectAttempts=t.resiliencyOptions.maxReconnectAttempts),this.networkManager=i?this.networkManager||new n.NetworkManager(new n.NonReconnectingWebSocket(t.url,t.port,r)):u?this.networkManager||new n.NetworkManager(new n.ReconnectingWebSocket(t.url,-1,u,e,r)):this.networkManager||new n.NetworkManager(new n.ReconnectingWebSocket(t.url,t.port,null,e,r)),this.networkManager.start(),this.resiliencyManager||(this.resiliencyManager=new n.DefaultResiliencyManager(this,this.sourceRefGenerator,this.networkManager,n.ServerStatus.Up)),this.authManager=this.authManager||new n.AuthManager(this.sourceRefGenerator,this.messageBuilder,this.networkManager),this.authManager.login(t).then(function(r){f.createResourceManager();f.startResiliencyManager();i?(f.failoverManager=f.failoverManager||new n.FailoverManager(f,f.sourceRefGenerator,f.messageBuilder,f.networkManager,f.resourceManager,f.resiliencyManager,f.authManager,t.port),f.failoverManager.start()):f.failoverManager=new n.DummyFailoverManager;var u=P.defer();return f.snapshot("ALL_PROCESSES_STATUS",{columns:"ROW_REF"}).then(function(){u.resolve({authToken:r.authToken,refreshToken:r.refreshToken,roles:r.roles,permissions:r.permissions})}).fail(function(n){n.DETAILS.ERROR==="User is not logged in and supplied auth token is invalid."?f.authManager.refreshToken().then(function(n){u.resolve({authToken:n.authToken,refreshToken:n.refreshToken,roles:n.roles,permissions:n.permissions})}).fail(function(){console.log("token renewal failed!");u.reject({message:"token renewal failed"})}):u.resolve({authToken:r.authToken,refreshToken:r.refreshToken,roles:r.roles,permissions:r.permissions})}),u.promise()}).fail(function(n){n.type&&n.type==="error"&&(f.failoverManager=null,f.resourceManager=null,f.authManager=null,f.resiliencyManager.stop(),f.resiliencyManager=null,f.networkManager.stop(),f.networkManager=null)}))},t.prototype.logout=function(){var n=this;return this.assertUserIsLoggedIn("User is not logged in so cannot log out"),this.authManager.logout().then(function(){n.failoverManager.stop();n.failoverManager=null;n.networkManager=null;n.authManager=null;n.resourceManager=null;n.resiliencyManager.stop();n.resiliencyManager=null})},t.prototype.isLoggedIn=function(){return this.authManager?this.authManager.isLoggedIn():!1},t.prototype.changePassword=function(n,t){return this.assertUserIsLoggedIn("User is not logged in so cannot change his own password"),this.authManager.changePassword(n,t)},t.prototype.stream=function(n,t){return this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in."),this.resourceManager.createSubscription(n,t)},t.prototype.snapshot=function(n,t){return this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in."),this.resourceManager.createSnapshot(n,t)},t.prototype.moreRows=function(n){this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in.");this.resourceManager.moreRows(n)},t.prototype.updateColumns=function(n,t,i){this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in.");this.resourceManager.updateColumns(n,t,i)},t.prototype.commit=function(n,t){return this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in."),this.resourceManager.commit(n,t)},t.prototype.request=function(n,t){return this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in."),this.resourceManager.request(n,t)},t.prototype.getResources=function(){return this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in."),this.resourceManager.getResources()},t.prototype.getMetadata=function(n){return this.assertUserIsLoggedIn("Invalid state exception. The user is not logged in."),this.resourceManager.getMetadata(n)},Object.defineProperty(t.prototype,"onServerReachable",{get:function(){return this.resiliencyManager.onServerStatus},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSubscriptionStatus",{get:function(){return this.resourceManager.onSubscriptionStatus},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeFailover",{get:function(){return this.failoverManager.onBeforeFailover},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterFailover",{get:function(){return this.failoverManager.onAfterFailover},enumerable:!0,configurable:!0}),t.prototype.authz=function(){return new n.AuthZ(this,this.authManager.userName)},t.prototype.messages=function(){return this.networkManager.messages},Object.defineProperty(t.prototype,"serverUrl",{get:function(){var n=this.resourceManager;return n.networkManager._webSocket.ws.url},enumerable:!0,configurable:!0}),t.prototype.startResiliencyManager=function(){this.resiliencyManager.start(this.stream("ALL_PROCESSES_STATUS",{columns:"PROCESS_HOSTNAME PROCESS_RESOURCES PROCESS_STATUS"}))},t.prototype.createResourceManager=function(){this.resourceManager=new n.ResourceManager(this.resiliencyManager.onResourcesStatus,this.resiliencyManager.onServerStatus,this.authManager,this.networkManager,this.sourceRefGenerator)},t.prototype.assertUserIsLoggedIn=function(n){if(!this.isLoggedIn())throw new Error(n);},t}();n.DTA=t}(Genesis||(Genesis={})),function(n){var u=function(){function i(n,t,i,r,u,f,e,o){this.dta=n;this.sourceRefGenerator=t;this.messageBuilder=i;this.networkManager=r;this.resourceManager=u;this.resiliencyManager=f;this.authManager=e;this.port=o;this._onBeforeFailover=new Rx.Subject;this._onAfterFailover=new Rx.Subject;this.current=0;this.nodes=[]}return i.prototype.start=function(){var t=this,n;this.setOnCloseEventHandler();n=this.messageBuilder.createRequestNodesMessage(this.sourceRefGenerator.newSourceRef());this.updateNodes(n);this.updateNodesTimerId=setInterval(function(){t.updateNodes(n)},r.requestNodesInterval)},i.prototype.stop=function(){this._onBeforeFailover=null;this._onAfterFailover=null;clearInterval(this.updateNodesTimerId)},Object.defineProperty(i.prototype,"onBeforeFailover",{get:function(){return this._onBeforeFailover},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAfterFailover",{get:function(){return this._onAfterFailover},enumerable:!0,configurable:!0}),i.prototype.updateNodes=function(n){var t=this;this.networkManager.send(n,function(n){for(var r=n.AVAILABLE_NODES.split(","),i=0;i<r.length;i++)t.nodes.push({url:r[i],port:t.port})})},i.prototype.reset=function(i){var r=this,f=new t(i.url,i.port),u;if(this._onBeforeFailover)this._onBeforeFailover.onNext(f);this.resiliencyManager.stop();u=new n.NonReconnectingWebSocket(i.url,i.port,!1);this.networkManager=new n.NetworkManager(u);this.networkManager.start();this.setOnCloseEventHandler();this.waitForConnection(u,function(){if(r.resiliencyManager.reset(r.networkManager),r.dta.isLoggedIn()&&r.resourceManager.reset(r.networkManager),r._onAfterFailover)r._onAfterFailover.onNext(f)},100)},i.prototype.waitForConnection=function(t,i,r){var u=this;t.readyState===n.ConnectivityConsts.OPEN?i():setTimeout(function(){u.waitForConnection(t,i,r)},r)},i.prototype.getNextAvailableNode=function(){return this.current++,this.current===this.nodes.length&&(this.current=0),this.nodes[this.current]},i.prototype.setOnCloseEventHandler=function(){var n=this;this.networkManager.onClose.subscribeOnNext(function(){var t=n.getNextAvailableNode();n.reset(t)})},i}(),i,r,t;n.FailoverManager=u;i=function(){function n(){this._onBeforeFailover=new Rx.Subject;this._onAfterFailover=new Rx.Subject}return n.prototype.start=function(){},n.prototype.stop=function(){},Object.defineProperty(n.prototype,"onBeforeFailover",{get:function(){return this._onBeforeFailover},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onAfterFailover",{get:function(){return this._onAfterFailover},enumerable:!0,configurable:!0}),n}();n.DummyFailoverManager=i;r=function(){function n(){}return n.requestNodesInterval=6e4,n}();t=function(){function n(n,t){this.url=n;this.port=t}return n}();n.FailoverEvent=t}(Genesis||(Genesis={})),function(n){var t=function(){function t(){}return t.prototype.newSourceRef=function(){return n.createGuid()},t}();n.GuidSourceRefGenerator=t}(Genesis||(Genesis={})),function(n){var t=function(){function t(){this._supportedParams=[n.Params.maxRows,n.Params.criteria,n.Params.columns,n.Params.requestFields,n.Params.validate,n.Params.ignoreWarnings,n.Params.details,n.Params.actAs,n.Params.orderBy,n.Params.reverse,n.Params.maxView,n.Params.movingView,n.Params.retryInterval,n.Params.maxRetryAttempts,n.Params.isParentFn,n.Params.drilldownFn,n.Params.skipPostProcessing,n.Params.hostname]}return t.prototype.parseResourceName=function(t,i){var u=t.split("|"),f=u[0],e=u[1],r={serviceName:f,messageType:e,unknown:[]};return i&&(i.maxRows&&(r[n.Params.maxRows]=i.maxRows),i.criteria&&(r[n.Params.criteria]=i.criteria),i.columns&&(r[n.Params.columns]=i.columns),i.actAs&&(r[n.Params.actAs]=i.actAs),i.orderBy&&(r[n.Params.orderBy]=i.orderBy),i.reverse&&(r[n.Params.reverse]=i.reverse),i.maxView&&(r[n.Params.maxView]=i.maxView),i.movingView&&(r[n.Params.movingView]=i.movingView),i.retryInterval&&(r[n.Params.retryInterval]=i.retryInterval),i.maxRetryAttempts&&(r[n.Params.maxRetryAttempts]=i.maxRetryAttempts),i.requestFields&&(r[n.Params.requestFields]=i.requestFields),i.details&&(r[n.Params.details]=i.details),i.hasOwnProperty(n.Params.ignoreWarnings)&&(r[n.Params.ignoreWarnings]=i.ignoreWarnings),i.hasOwnProperty(n.Params.validate)&&(r[n.Params.validate]=i.validate),i.isParentFn&&(r[n.Params.isParentFn]=i.isParentFn),i.drilldownFn&&(r[n.Params.drilldownFn]=i.drilldownFn),i.hostname&&(r[n.Params.hostname]=i.hostname),this._checkForUnsupportedParams(i)),{params:r}},t.prototype._checkForUnsupportedParams=function(n){for(var t in n)if(n.hasOwnProperty(t)&&this._supportedParams.indexOf(t)===-1)throw new Error("'"+t+"' is not a supported DTA param.");},t}();n.JsonParamsParser=t}(Genesis||(Genesis={})),function(n){var t=function(){function n(n,t,i,r,u){this.url=n;this.port=t;this.credentials=i;this.resiliencyOptions=r;this.authToken=u}return n}();n.LoginOptions=t}(Genesis||(Genesis={})),function(n){var i=function(){function i(){}return i.prototype.createLoginMessage=function(n,i){return{SOURCE_REF:n,MESSAGE_TYPE:t.loginMessageType,SERVICE_NAME:t.loginServiceName,DETAILS:{USER_NAME:i.userName,PASSWORD:i.password}}},i.prototype.createRefreshTokenMessage=function(n,i,r){return{SOURCE_REF:n,MESSAGE_TYPE:t.loginMessageType,SERVICE_NAME:t.loginServiceName,DETAILS:{USER_NAME:i,REFRESH_AUTH_TOKEN:r}}},i.prototype.createLogoutMessage=function(n,i,r,u){return{SOURCE_REF:n,MESSAGE_TYPE:t.logoutMessageType,SERVICE_NAME:t.logoutServiceName,USER_NAME:r,SESSION_AUTH_TOKEN:i,SESSION_ID:u}},i.prototype.createDataLogonMessage=function(i,r,u,f,e){var o={SOURCE_REF:i,MESSAGE_TYPE:t.dataLogonMessageType,USER_NAME:u,DETAILS:{DATASOURCE_NAME:f},SESSION_AUTH_TOKEN:r};return e&&(e[n.Params.maxRows]&&(o.DETAILS[t.dataLogonParamsMaxRows]=e[n.Params.maxRows]),e[n.Params.criteria]&&(o.DETAILS[t.dataLogonParamsCriteria]=e[n.Params.criteria]),e[n.Params.columns]&&(o.DETAILS[t.dataLogonParamsColumns]=e[n.Params.columns]),e[n.Params.orderBy]&&(o.DETAILS[t.dataLogonParamsOrderBy]=e[n.Params.orderBy]),e[n.Params.reverse]&&(o.DETAILS[t.dataLogonParamsReverse]=e[n.Params.reverse]),e[n.Params.maxView]&&(o.DETAILS[t.dataLogonParamsMaxView]=e[n.Params.maxView]),e[n.Params.movingView]&&(o.DETAILS[t.dataLogonParamsMovingView]=e[n.Params.movingView])),o},i.prototype.createMetadataMessage=function(n,i,r){return{SOURCE_REF:n,MESSAGE_TYPE:t.metadataMessageType,DETAILS:{FEATURE:r},SESSION_AUTH_TOKEN:i}},i.prototype.createGetResourcesMessage=function(n,i){return{SOURCE_REF:n,MESSAGE_TYPE:t.resourcesMessageType,SESSION_AUTH_TOKEN:i}},i.prototype.createRequestMessage=function(t,i,r,u){var f={SOURCE_REF:t,MESSAGE_TYPE:u.serviceName,USER_NAME:r,REQUEST:{},DETAILS:{},SESSION_AUTH_TOKEN:i},e;delete u.messageType;for(e in u)u.hasOwnProperty(e)&&(f[e]=u[e]);return u.hasOwnProperty(n.Params.hostname)&&(f.HOSTNAME=f[n.Params.hostname],delete f[n.Params.hostname]),u.hasOwnProperty(n.Params.requestFields)&&(f.REQUEST=f[n.Params.requestFields],delete f[n.Params.requestFields]),u.hasOwnProperty(n.Params.maxRows)?(f.DETAILS.MAX_ROWS=f[n.Params.maxRows],delete f[n.Params.maxRows]):delete f.DETAILS,u.hasOwnProperty(n.Params.actAs)&&delete f[n.Params.actAs],f},i.prototype.createCommitMessage=function(t,i,r,u,f){var e={SOURCE_REF:t,MESSAGE_TYPE:u,USER_NAME:r,SESSION_AUTH_TOKEN:i};for(var o in f)f.hasOwnProperty(o)&&(e[o]=f[o]);return f.hasOwnProperty(n.Params.hostname)&&(e.HOSTNAME=e[n.Params.hostname],delete e[n.Params.hostname]),f.hasOwnProperty(n.Params.details)&&(e.DETAILS=e[n.Params.details],delete e[n.Params.details]),f.hasOwnProperty(n.Params.validate)&&(e.VALIDATE=e[n.Params.validate],delete e[n.Params.validate]),f.hasOwnProperty(n.Params.ignoreWarnings)&&(e.IGNORE_WARNINGS=e[n.Params.ignoreWarnings],delete e[n.Params.ignoreWarnings]),f.hasOwnProperty(n.Params.actAs)&&delete e[n.Params.actAs],e},i.prototype.createDataLogoffMessage=function(n,i){return{SOURCE_REF:n,MESSAGE_TYPE:t.dataLogoffMessageType,SESSION_AUTH_TOKEN:i}},i.prototype.createChangePasswordMessage=function(n,i,r,u,f){return{MESSAGE_TYPE:t.changePasswordMessageType,SOURCE_REF:n,DETAILS:{USER_NAME:r,OLD_PASSWORD:u,NEW_PASSWORD:f},SESSION_AUTH_TOKEN:i}},i.prototype.createHeartbeatMessage=function(n){return{MESSAGE_TYPE:t.heartbeatMessageType,SOURCE_REF:n}},i.prototype.createRequestNodesMessage=function(n){return{MESSAGE_TYPE:t.requestNodesMessageType,SOURCE_REF:n}},i.prototype.createMoreRowsMessage=function(n,i,r){return{MESSAGE_TYPE:t.moreRowsMessageType,SOURCE_REF:n,SESSION_AUTH_TOKEN:r,DETAILS:{SOURCE_REF:i}}},i.prototype.createUpdateColumnsMessage=function(n,i,r,u,f){return{MESSAGE_TYPE:t.updateColumnsMessageType,SOURCE_REF:n,SESSION_AUTH_TOKEN:f,DETAILS:{SOURCE_REF:i,ADD_COLUMNS:r,DROP_COLUMNS:u}}},i}(),t;n.MessageBuilder=i;t=function(){function n(){}return n.loginMessageType="TXN_LOGIN_AUTH",n.loginServiceName="AUTH_MANAGER",n.logoutMessageType="TXN_LOGOUT",n.logoutServiceName="AUTH_MANAGER",n.metadataMessageType="META_REQUEST",n.resourcesMessageType="RESOURCES_REQUEST",n.changePasswordMessageType="TXN_CHANGE_USER_PASSWORD",n.dataLogonMessageType="DATA_LOGON",n.dataLogonParamsMaxRows="MAX_ROWS",n.dataLogonParamsCriteria="CRITERIA_MATCH",n.dataLogonParamsColumns="FIELDS",n.dataLogonParamsOrderBy="ORDER_BY",n.dataLogonParamsReverse="REVERSE",n.dataLogonParamsMaxView="MAX_VIEW",n.dataLogonParamsMovingView="MOVING_VIEW",n.dataLogonAck="LOGON_ACK",n.dataLogonNack="LOGON_NACK",n.dataLogoffMessageType="DATA_LOGOFF",n.shutdown="DATA_LOG_TERMINATED",n.heartbeatMessageType="HEARTBEAT_PING",n.requestNodesMessageType="REQUEST_NODES",n.moreRowsMessageType="MORE_ROWS",n.updateColumnsMessageType="MORE_COLUMNS",n}()}(Genesis||(Genesis={})),function(n){var i=function(){function i(n){this._onOpenSubject=new Rx.Subject;this._onCloseSubject=new Rx.Subject;this._messageListeners={};this._loggingSubject=new Rx.ReplaySubject(3);n&&(this._webSocket=n)}return i.prototype.start=function(){this._setupWebSocketEventHandlers()},i.prototype.stop=function(){this._webSocket.close(1e3);this._webSocket=undefined},i.prototype.send=function(n,t,i,r){var f=this,u;r===void 0&&(r=!1);this.addMessageListener(n.SOURCE_REF,t,i,r);this._log({isOutgoing:!0,message:n});u=JSON.stringify(n);this._waitForConnection(function(){f._webSocket.send(u)})},i.prototype.addMessageListener=function(n,i,r,u){u===void 0&&(u=!1);this._messageListeners[n]=new t(i,r,u)},i.prototype.removeMessageListener=function(n){delete this._messageListeners[n]},Object.defineProperty(i.prototype,"onOpen",{get:function(){return this._onOpenSubject},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onClose",{get:function(){return this._onCloseSubject},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"messages",{get:function(){return this._loggingSubject},enumerable:!0,configurable:!0}),i.prototype._setupWebSocketEventHandlers=function(){var n=this;this.setWebSocketOnMessageEventHandler();this.setWebSocketOnErrorEventHandler();this._webSocket.addOnCloseEvtHandler(function(t){n._onCloseSubject.onNext(t);n._messageListeners={}});this._webSocket.setOnOpenEvtHandler(function(t){n.setWebSocketOnMessageEventHandler();n.setWebSocketOnErrorEventHandler();var i=n._webSocket;i._onclose.length===0&&n._webSocket.addOnCloseEvtHandler(function(t){n._onCloseSubject.onNext(t);n._messageListeners={}});n._onOpenSubject.onNext(t)})},i.prototype.setWebSocketOnMessageEventHandler=function(){var n=this;this._webSocket.onmessage=function(t){var r=JSON.parse(t.data),i;if(n._log({isOutgoing:!1,message:r}),i=r.SOURCE_REF,i&&n._messageListeners[i]&&n._messageListeners[i].onSuccess)n._messageListeners[i].onSuccess(r);n._messageListeners[i]&&!n._messageListeners[i].keepAlive&&delete n._messageListeners[i]}},i.prototype.setWebSocketOnErrorEventHandler=function(){var n=this;this._webSocket.onerror=function(t){if(n._messageListeners)for(var i in n._messageListeners)n._messageListeners[i].onError(t)}},i.prototype._waitForConnection=function(t,i){var r=this;this._webSocket&&(this._webSocket.readyState===n.ConnectivityConsts.OPEN?t():setTimeout(function(){r._waitForConnection(t,i)},i))},i.prototype._log=function(n){n.timestamp=(new Date).getTime();this._loggingSubject.onNext(n)},i}(),t;n.NetworkManager=i;t=function(){function n(n,t,i){this.onSuccessFn=n;this.onErrorFn=t;this._keepAlive=i}return Object.defineProperty(n.prototype,"onSuccess",{get:function(){return this.onSuccessFn},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onError",{get:function(){return this.onErrorFn},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"keepAlive",{get:function(){return this._keepAlive},enumerable:!0,configurable:!0}),n}()}(Genesis||(Genesis={})),function(n){var t=function(){function n(){}return n.maxRows="maxRows",n.criteria="criteria",n.columns="columns",n.requestFields="requestFields",n.validate="validate",n.ignoreWarnings="ignoreWarnings",n.details="details",n.actAs="actAs",n.orderBy="orderBy",n.reverse="reverse",n.maxView="maxView",n.movingView="movingView",n.retryInterval="retryInterval",n.maxRetryAttempts="maxRetryAttempts",n.isParentFn="isParentFn",n.drilldownFn="drilldownFn",n.skipPostProcessing="skipPostProcessing",n.hostname="hostname",n}();n.Params=t}(Genesis||(Genesis={})),function(n){var t=function(){function n(n,t,i,r,u){n===void 0&&(n=1e3);t===void 0&&(t=3e4);i===void 0&&(i=1.5);r===void 0&&(r=2e3);this.reconnectInterval=n;this.maxReconnectInterval=t;this.reconnectDecay=i;this.timeoutInterval=r;this.maxReconnectAttempts=u}return n}();n.ResiliencyOptions=t}(Genesis||(Genesis={})),function(n){var i=function(){function i(t,i,r,u,f){var e=this;this.authProvider=r;this._onSubscriptionStatus=new Rx.Subject;this._sourceRefsByResourceName={};this.subscriptionsInfos={};this._messageBuilder=new n.MessageBuilder;this._parser=new n.JsonParamsParser;this.networkManager=u;this._sourceRefGenerator=f;t.subscribeOnNext(function(n){for(var t=0;t<n.length;t++)e._tryRestoreSubscriptions(n[t])});i.subscribeOnNext(function(t){t===n.ServerStatus.Up&&e.getResources().then(function(t){var i=n.extend({},e.subscriptionsInfos);for(var r in i)i.hasOwnProperty(r)&&t.some(function(n){return n.RESOURCE_NAME===i[r].resourceName})&&(e._restoreSubscription(i[r]),delete e.subscriptionsInfos[r])})})}return i.prototype.createSubscription=function(i,r){var u=this,f,e,s,o;return this._validateResourceName(i),f=this._parser.parseResourceName(i,r),e=r&&r.actAs?r.actAs:this.authProvider.userName,r?(r.maxRetryAttempts===undefined||r.maxRetryAttempts===null)&&(r.maxRetryAttempts=-1):r={maxRetryAttempts:-1},r.retryInterval=r.retryInterval||3e3,s=this.authProvider.authToken,o=Rx.Observable.create(function(o){var s=u._sourceRefGenerator.newSourceRef(),h,c;return o.srcRef=s,h=0,c=function(){var l=u._messageBuilder.createDataLogonMessage(s,u.authProvider.authToken,e,i,f.params);(r.maxRetryAttempts===-1||h<=r.maxRetryAttempts)&&(h++,u.networkManager.send(l,function(f){var a=f.MESSAGE_TYPE,e,l;switch(a){case n.Consts.dataLogonAck:e=r.skipPostProcessing?new n.SkipPostProcessingSubscriptionInfo(i,o,s,r):new n.SubscriptionInfo(i,o,s,r);u.subscriptionsInfos[s]=e;u._sourceRefsByResourceName[i]||(u._sourceRefsByResourceName[i]=[]);u._sourceRefsByResourceName[i].push(e);break;case n.Consts.dataLogonNack:o.onError({kind:n.Consts.dataLogonNack});break;case n.Consts.msgNack:o.onError({message:f.ERROR[0].CODE});break;case n.Consts.queryUpdateMessageType:try{u.subscriptionsInfos[s].onNewData(f)}catch(v){}break;case n.Consts.shutdown:u._onSubscriptionStatus.onNext(new t(i,r,!1));break;default:if(l=f,l.DETAILS.ERROR.indexOf("does not exist"))if(r.maxRetryAttempts!==-1&&h>=r.maxRetryAttempts)o.onError(f);else setTimeout(function(){c()},r.retryInterval);else o.onError(f)}},null,!0))},c(),Rx.Disposable.create(function(){var t,n;u._sendTermSignal(s);delete u.subscriptionsInfos[s];for(t in u._sourceRefsByResourceName)for(n=0;n<u._sourceRefsByResourceName[t].length;n++)u._sourceRefsByResourceName[t][n].sourceRef===s&&u._sourceRefsByResourceName[t].splice(n,1);u.networkManager.removeMessageListener(s)})}),o},Object.defineProperty(i.prototype,"onSubscriptionStatus",{get:function(){return this._onSubscriptionStatus},enumerable:!0,configurable:!0}),i.prototype.createSnapshot=function(n,t){var i=P.defer(),r;return t?t.maxRetryAttempts=0:t={maxRetryAttempts:0},r=this.createSubscription(n,t).take(1).subscribe(function(n){i.resolve(n.all);r.dispose()},function(n){i.reject(n);r.dispose()},null),i.promise()},i.prototype.moreRows=function(n){var t=this._sourceRefGenerator.newSourceRef(),i=n.srcRef,r=this._messageBuilder.createMoreRowsMessage(t,i,this.authProvider.authToken);this.networkManager.send(r)},i.prototype.updateColumns=function(n,t,i){t===""&&(t=undefined);i===""&&(i=undefined);var r=this._sourceRefGenerator.newSourceRef(),u=n.srcRef,f=this._messageBuilder.createUpdateColumnsMessage(r,u,t,i,this.authProvider.authToken);this.networkManager.send(f)},i.prototype.commit=function(t,i){var r=this;this._validateResourceName(t);var u=function(t,i){return t.params[n.Params.maxRows]||t.params[n.Params.criteria]||t.params[n.Params.columns]?(i.reject({message:"TransactionHandlers do not support 'maxRows', 'criteria', or 'columns' params."}),!1):!0},f=function(n,t){var u;return u=i&&i.actAs?i.actAs:r.authProvider.userName,r._messageBuilder.createCommitMessage(t,r.authProvider.authToken,u,n.params.serviceName,i)},e=function(t,i){var r=t.MESSAGE_TYPE,u=!1;if(r&&r.indexOf("TXN_")===0&&(r.endsWith("_ACK")?(i.resolve(t),u=!0):r.endsWith("_NACK")&&(i.reject({errors:t.ERROR,warnings:t.WARNING}),u=!0)),!u)switch(r){case n.Consts.msgNack:i.reject({message:t.ERROR[0].CODE});break;default:i.reject(t)}};return this._sendRequest(t,i,u,f,e)},i.prototype.request=function(t,i){var r=this;this._validateResourceName(t);var u=function(t,i){return t.params[n.Params.criteria]||t.params[n.Params.columns]?(i.reject({message:"RequestReplies do not support the 'criteria' or 'columns' params."}),!1):!0},f=function(n,t){var u;return u=i&&i.actAs?i.actAs:r.authProvider.userName,r._messageBuilder.createRequestMessage(t,r.authProvider.authToken,u,n.params)},e=function(n,t,i){var r=n.MESSAGE_TYPE;switch(r){case"REP"+i.slice(3):t.resolve(n);break;default:t.reject({message:n.ERROR[0].CODE})}};return this._sendRequest("REQ_"+t,i,u,f,e)},i.prototype.getResources=function(){var t=this,i=function(){return!0},r=function(n,i){return t._messageBuilder.createGetResourcesMessage(i,t.authProvider.authToken)},u=function(t,i){var r=t.MESSAGE_TYPE;r===n.Consts.resourceAck?i.resolve(t.RESOURCES):i.reject(t)};return this._sendRequest(n.Consts.resourcesMessageType,{},i,r,u)},i.prototype.getMetadata=function(t){var i=this,r=function(){return!0},u=function(n,t){return i._messageBuilder.createMetadataMessage(t,i.authProvider.authToken,n.params.serviceName)},f=function(t,i){var r=t.MESSAGE_TYPE;r===n.Consts.metadataAck?i.resolve(t.DETAILS):i.reject(t)};return this._sendRequest(t,{},r,u,f)},i.prototype.reset=function(t){var i,r;this.networkManager=t;i=n.extend({},this.subscriptionsInfos);for(r in i)i.hasOwnProperty(r)&&(this._restoreSubscription(i[r]),delete this.subscriptionsInfos[r])},i.prototype._sendRequest=function(n,t,i,r,u){var f=this._parser.parseResourceName(n,t),e=P.defer(),o,h,s;for(o in f.params.unknown)if(f.params.unknown.hasOwnProperty(o))return e.reject({message:"Unknown parameter in resource string: "+f.params.unknown[o]}),e.promise();return delete f.params.unknown,i(f,e)&&(h=this._sourceRefGenerator.newSourceRef(),s=r(f,h),delete s.serviceName,this.networkManager.send(s,function(n){u(n,e,f.params.serviceName)},function(n){return e.reject(n)})),e.promise()},i.prototype._sendTermSignal=function(n){var t=this._messageBuilder.createDataLogoffMessage(n,this.authProvider.authToken);this.networkManager.send(t)},i.prototype._tryRestoreSubscriptions=function(n){var t=this;this._sourceRefsByResourceName[n]&&this._sourceRefsByResourceName[n].forEach(function(n){t._restoreSubscription(n);delete t.subscriptionsInfos[n.sourceRef];t.networkManager.removeMessageListener(n.sourceRef)})},i.prototype._restoreSubscription=function(n){delete this._sourceRefsByResourceName[n.resourceName];var i=n.observer,r=Rx.Observer.create(i.observer._onNext,i.observer._onError,i.observer._onCompleted);this.createSubscription(n.resourceName,n.params).subscribe(r);this._onSubscriptionStatus.onNext(new t(n.resourceName,n.params,!0))},i.prototype._validateResourceName=function(n){var t=n.split("/");if(t.length>2)throw new Error("Resource string format not supported: more than 2-level nesting.");},i}(),t;n.ResourceManager=i;t=function(){function n(n,t,i){this.resourceName=n;this.params=t;this.isUp=i}return n}();n.SubscriptionStatusChangedEvent=t}(Genesis||(Genesis={})),function(n){var t=function(){function n(n,t){this.userName=n;this.password=t}return n}();n.UserCredentials=t}(Genesis||(Genesis={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(){function t(n,t,i,r){this.update={};this.all=[];this._resourceName=n;this._observer=t;this._sourceRef=i;r&&(this._params=r)}return Object.defineProperty(t.prototype,"resourceName",{get:function(){return this._resourceName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"observer",{get:function(){return this._observer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceRef",{get:function(){return this._sourceRef},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),t.prototype.onNewData=function(t){var u=[],f=[],w=[],i,g,c,d,l,b,o,s,r,y,v,p,e,h,k,a;if(!t.ROW){if(this.all.length===0){this._observer.onNext({all:[]});return}this._observer.onNext({all:this.all,inserts:[]});return}for(i=0;i<t.ROW.length;i++){g=t.ROW[i].DETAILS.OPERATION;switch(g){case n.Consts.queryUpdateInsert:u.push(t.ROW[i]);break;case n.Consts.queryUpdateModify:f.push(t.ROW[i]);break;case n.Consts.queryUpdateDelete:w.push(t.ROW[i]);break;default:this._observer.onError.bind(this._observer)}}if(c=[],u.length>0){for(i=0;i<u.length;i++)e=u[i].DETAILS.ROW_REF,delete u[i].DETAILS,this.update[e]=u[i],d=u[i],d.ROW_REF=e,this.all.push(d),c.push(e);if(this.params.drilldownFn)for(l=0;l<u.length;l++)if((!this.params.isParentFn||this.params.isParentFn(u[l]))&&this.params.drilldownFn(this.all,u[l],-1,!0),u[l].DRILLDOWN){for(o=0;o<u[l].DRILLDOWN.length;o++)if(u[l].DRILLDOWN[o].ROW)for(s=0;s<u[l].DRILLDOWN[o].ROW.length;s++)if(b=u[l].DRILLDOWN[o].ROW[s].DETAILS.OPERATION,b==="INSERT"||b==="MODIFY"){for(b==="MODIFY"&&console.log("Parent.INSERT + Child.MODIFY: check the server message, treating as Child.INSERT!"),r=$.extend({},u[l].DRILLDOWN[o].ROW[s]),r.ROW_REF=r.DETAILS.ROW_REF,r.PARENT_ROW_REF=u[l].ROW_REF,delete r.DETAILS,this.update[r.ROW_REF]=r,y=!1,v=0;!y;)this.all[v].ROW_REF===r.PARENT_ROW_REF?y=!0:v++;p=v+s+1;this.all.splice(p,0,r);c.push(r.ROW_REF);this.params.drilldownFn(this.all,r,p,!1)}delete u[l].DRILLDOWN}this._observer.onNext({all:this.all,inserts:c})}if(f.length>0){for(c=[],i=0;i<f.length;i++){e=f[i].DETAILS.ROW_REF;delete f[i].DETAILS;for(h in f[i])if(k=this.update[e][h],this.update[e][h]=f[i][h],h!=="DRILLDOWN")c.push({ROW_REF:e,details:{field:h,oldValue:k,newValue:f[i][h]}});else{for(o=0;o<f[i].DRILLDOWN.length;o++)if(f[i].DRILLDOWN[o].ROW)for(s=0;s<f[i].DRILLDOWN[o].ROW.length;s++)if(f[i].DRILLDOWN[o].ROW[s].DETAILS.OPERATION==="INSERT"){for(r=$.extend({},f[i].DRILLDOWN[o].ROW[s]),r.ROW_REF=r.DETAILS.ROW_REF,r.PARENT_ROW_REF=e,delete r.DETAILS,y=!1,v=1;!y;)this.all[v].ROW_REF===e?y=!0:v++;p=v+s+1;this.all.splice(p,0,r);this.update[r.ROW_REF]=r;c.push(r.ROW_REF);this.params.drilldownFn(this.all,r,p,!1)}else{e=f[i].DRILLDOWN[o].ROW[s].DETAILS.ROW_REF;for(h in f[i].DRILLDOWN[o].ROW[s])h!=="DETAILS"&&(k=this.update[e][h],this.update[e][h]=f[i].DRILLDOWN[o].ROW[s][h],c.push({ROW_REF:e,details:{field:h,oldValue:k,newValue:f[i].DRILLDOWN[o].ROW[s][h]}}))}delete f[i].DRILLDOWN}}this._observer.onNext({all:this.all,updates:c})}if(w.length>0){for(c=[],i=0;i<w.length;i++){if(e=w[i].DETAILS.ROW_REF,this.params.drilldownFn)for(a=0;a<this.all.length;a++)this.all[a].PARENT_ROW_REF===e&&(c.push(this.all[a].ROW_REF),this.all.splice(a,1));for(a=0;a<this.all.length;a++)this.all[a].ROW_REF===e&&this.all.splice(a,1);c.push(e)}this.observer.onNext({all:this.all,deletes:c})}},t}(),i;n.SubscriptionInfo=t;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.onNewData=function(n){if(!n.ROW){this.observer.onNext({all:[]});return}this.observer.onNext({all:n.ROW});return},t}(t);n.SkipPostProcessingSubscriptionInfo=i}(Genesis||(Genesis={}));